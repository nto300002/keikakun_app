# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¤‡åˆæ¡ä»¶æ¤œç´¢ - å®Ÿè£…TODO

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**ç›®çš„**: åˆ©ç”¨è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¤‡åˆæ¡ä»¶æ¤œç´¢æ©Ÿèƒ½ã‚’å®Œå…¨å®Ÿè£…ã—ã€UXã‚’æ”¹å–„ã™ã‚‹

**å„ªå…ˆåº¦**: **é«˜**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«ç›´æ¥å½±éŸ¿ï¼‰

**ç·å·¥æ•°**: ç´„3.5æ—¥ï¼ˆ26æ™‚é–“ï¼‰

---

## ğŸ¯ å®Ÿè£…è¦ä»¶

### 1. ç·åˆ©ç”¨è€…æ•°ã¨æ¤œç´¢çµæœæ•°ã®åˆ†é›¢ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰

#### ç¾åœ¨ã®å•é¡Œ
- `current_user_count` ãŒæ¤œç´¢çµæœæ•°ã‚’è¡¨ç¤ºã—ã¦ã—ã¾ã†
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‰ã®ç·åˆ©ç”¨è€…æ•°ãŒåˆ†ã‹ã‚‰ãªã„
- è«‹æ±‚ç®¡ç†ã¨ã®æ•´åˆæ€§ãŒå–ã‚Œãªã„

#### æ”¹å–„å†…å®¹

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: `DashboardData` ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ
```python
class DashboardData(DashboardBase):
    """ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æƒ…å ±ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰"""
    current_user_count: int      # ç·åˆ©ç”¨è€…æ•°ï¼ˆå¸¸ã«å›ºå®šï¼‰
    filtered_count: int           # æ¤œç´¢çµæœæ•°ï¼ˆæ–°è¦è¿½åŠ ï¼‰â† ã“ã‚Œã‚’è¿½åŠ 
    max_user_count: int
    billing_status: BillingStatus
    recipients: List[DashboardSummary]
```

**APIå®Ÿè£…**:
```python
# k_back/app/api/v1/endpoints/dashboard.py

# 1. ç·åˆ©ç”¨è€…æ•°ã‚’å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç„¡è¦–ï¼‰
current_user_count = await crud.dashboard.count_office_recipients(
    db=db,
    office_id=office.id
)  # â† æ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 1.1ï¼‰

# 2. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®ãƒªã‚¹ãƒˆã‚’å–å¾—
filtered_results = await crud.dashboard.get_filtered_summaries(...)

# 3. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
filtered_count = len(filtered_results)  # â† ã“ã‚Œã‚’è¿½åŠ 

return schemas.dashboard.DashboardData(
    current_user_count=current_user_count,  # ç·åˆ©ç”¨è€…æ•°ï¼ˆå›ºå®šï¼‰
    filtered_count=filtered_count,          # æ¤œç´¢çµæœæ•°ï¼ˆæ–°è¦ï¼‰
    recipients=recipient_summaries
)
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: è¡¨ç¤ºåˆ†é›¢
```typescript
// k_front/components/protected/dashboard/Dashboard.tsx

// ç·åˆ©ç”¨è€…æ•°ã®è¡¨ç¤ºï¼ˆå¸¸ã«å›ºå®šï¼‰
<div className="user-count">
  ç·åˆ©ç”¨è€…æ•°: {dashboardData.current_user_count}å
</div>

// æ¤œç´¢çµæœæ•°ã®è¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ™‚ã®ã¿ï¼‰
{dashboardData.filtered_count !== dashboardData.current_user_count && (
  <div className="filtered-count">
    æ¤œç´¢çµæœ: {dashboardData.filtered_count}å
  </div>
)}
```

---

### 2. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åã®æ˜ç¢ºåŒ–ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰

#### ç¾åœ¨ã®å•é¡Œ
- âŒ ã€ŒæœŸé™åˆ‡ã‚Œã€ã€ŒæœŸé™é–“è¿‘ã€ãŒä½•ã®æœŸé™ã‹ä¸æ˜

#### æ”¹å–„å†…å®¹

| ç¾åœ¨ | æ”¹å–„å¾Œ | èª¬æ˜ |
|------|--------|------|
| âŒ æœŸé™åˆ‡ã‚Œ | âœ… è¨ˆç”»æœŸé™åˆ‡ã‚Œ | æ¬¡å›æ›´æ–°æœŸé™ãŒéããŸåˆ©ç”¨è€… |
| âŒ æœŸé™é–“è¿‘ | âœ… è¨ˆç”»æœŸé™é–“è¿‘ï¼ˆæ®‹ã‚Š30æ—¥ï¼‰ | æ¬¡å›æ›´æ–°æœŸé™ã¾ã§30æ—¥ä»¥å†… |
| âŒ ãªã— | âœ… ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Š | ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ â†’ åŸæ¡ˆ â†’ æ‹…å½“è€…ä¼šè­° â†’ æœ¬æ¡ˆ â†’ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼‰ |

**å®Ÿè£…ç®‡æ‰€**:
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `k_front/components/protected/dashboard/Dashboard.tsx`
- UIæ–‡è¨€ã®å¤‰æ›´ã®ã¿ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ãªã—ï¼‰

---

### 3. ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰

#### è¿½åŠ æ©Ÿèƒ½
æœªå®Œäº†ã®ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹åˆ©ç”¨è€…ã‚’æŠ½å‡º

**å€‹åˆ¥æ”¯æ´è¨ˆç”»ã®5ã¤ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:
1. ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ
2. å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸åŸæ¡ˆ
3. æ‹…å½“è€…ä¼šè­°
4. å€‹åˆ¥æ”¯æ´è¨ˆç”»æ›¸æœ¬æ¡ˆ
5. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ **:
```python
# k_back/app/api/v1/endpoints/dashboard.py
@router.get("/", response_model=schemas.dashboard.DashboardData)
async def get_dashboard(
    ...
    has_assessment_due: Annotated[
        Optional[bool],
        Query(description="ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹åˆ©ç”¨è€…ã®ã¿")
    ] = None,
):
```

**ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶è¿½åŠ **:
```python
# k_back/app/crud/crud_dashboard.py (Line 145ä»˜è¿‘ã«è¿½åŠ )

if filters.get("has_assessment_due"):
    # ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆæœªå®Œäº†ã®ã¿ï¼‰
    # å€‹åˆ¥æ”¯æ´è¨ˆç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ â†’ åŸæ¡ˆ â†’ æ‹…å½“è€…ä¼šè­° â†’ æœ¬æ¡ˆ â†’ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
    assessment_exists_subq = exists(
        select(1).where(
            and_(
                SupportPlanStatus.plan_cycle_id == SupportPlanCycle.id,
                SupportPlanStatus.step_type == SupportPlanStep.assessment,
                SupportPlanStatus.completed == False,
                SupportPlanStatus.due_date.isnot(None)
            )
        )
    )
    stmt = stmt.where(assessment_exists_subq)
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

**ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UIè¿½åŠ **:
```typescript
// k_front/components/protected/dashboard/Dashboard.tsx

const [activeFilters, setActiveFilters] = useState({
  isOverdue: false,
  isUpcoming: false,
  hasAssessmentDue: false,  // â† è¿½åŠ ï¼ˆã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ï¼‰
  status: null,
});

// UIã«è¿½åŠ 
<FilterButton
  active={activeFilters.hasAssessmentDue}
  onClick={() => handleFilterToggle('hasAssessmentDue')}
>
  ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Š
</FilterButton>
```

---

### 4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆé †ã®å¤‰æ›´ï¼ˆå„ªå…ˆåº¦ï¼šä½ï¼‰

#### ç¾åœ¨ã®å®Ÿè£…
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `name_phonetic`ï¼ˆãµã‚ŠãŒãªæ˜‡é †ï¼‰

#### æ”¹å–„å¾Œ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `next_renewal_deadline`ï¼ˆæ¬¡å›æ›´æ–°æœŸé™æ˜‡é †ã€NULLã¯æœ€å¾Œï¼‰
- ç†ç”±: æœŸé™ãŒè¿‘ã„åˆ©ç”¨è€…ã‚’å„ªå…ˆçš„ã«è¡¨ç¤º

**å¤‰æ›´ç®‡æ‰€**:
```python
# k_back/app/api/v1/endpoints/dashboard.py
@router.get("/")
async def get_dashboard(
    sort_by: str = 'next_renewal_deadline',  # â† å¤‰æ›´
    sort_order: str = 'asc',
):
```

```typescript
// k_front/components/protected/dashboard/Dashboard.tsx
const [sortBy, setSortBy] = useState('next_renewal_deadline');  // â† å¤‰æ›´
```

---

### 5. è¤‡åˆæ¡ä»¶ã®æ­£ã—ã„å®Ÿè£…ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰

#### ç¾åœ¨ã®å•é¡Œ
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§çŠ¶æ…‹ç®¡ç†ãŒä¸ååˆ†
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã«ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹

#### æ”¹å–„å†…å®¹

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: æ—¢ã«è¤‡åˆæ¡ä»¶ï¼ˆANDï¼‰ã«å¯¾å¿œæ¸ˆã¿
```python
# k_back/app/crud/crud_dashboard.py (Line 140-165)
# ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒANDæ¡ä»¶ã§é©ç”¨ã•ã‚Œã‚‹
if filters.get("is_overdue"):
    stmt = stmt.where(...)
if filters.get("is_upcoming"):
    stmt = stmt.where(...)
if filters.get("status"):
    stmt = stmt.where(...)
# â† ã“ã‚Œã‚‰ã™ã¹ã¦ãŒANDã§çµåˆã•ã‚Œã‚‹
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: çŠ¶æ…‹ç®¡ç†ã®æ”¹å–„ãŒå¿…è¦
```typescript
// ç¾åœ¨ã®å•é¡Œ: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã«ä»–ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
const handleFilterToggle = (filterKey: string) => {
  setActiveFilters({
    ...activeFilters,  // â† æ—¢å­˜ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä¿æŒ
    [filterKey]: !activeFilters[filterKey]
  });
};

// APIãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ã™ã¹ã¦ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é€ä¿¡
const params = {
  search_term: searchTerm,
  sort_by: sortBy,
  sort_order: sortOrder,
  is_overdue: activeFilters.isOverdue || undefined,
  is_upcoming: activeFilters.isUpcoming || undefined,
  has_assessment_due: activeFilters.hasAssessmentDue || undefined,  // â† å¤‰æ›´
  status: activeFilters.status || undefined,
};
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ä»¶

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

#### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (`tests/crud/test_crud_dashboard.py`)

**æ–°è¦è¿½åŠ ãŒå¿…è¦**:

```python
class TestDashboardFiltering:
    """è¤‡åˆæ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ"""

    async def test_assessment_due_filter(self, db: AsyncSession):
        """ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæ­£ã—ãå‹•ä½œã™ã‚‹"""
        # Setup: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Šã®åˆ©ç”¨è€…ã‚’ä½œæˆ
        # Test: has_assessment_due=True ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        # Assert: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Šã®åˆ©ç”¨è€…ã®ã¿å–å¾—ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¯¾å¿œï¼‰

    async def test_compound_filters_and_condition(self, db: AsyncSession):
        """è¤‡åˆæ¡ä»¶ï¼ˆANDï¼‰ãŒæ­£ã—ãå‹•ä½œã™ã‚‹"""
        # Setup: è¤‡æ•°ã®æ¡ä»¶ã‚’æº€ãŸã™/æº€ãŸã•ãªã„åˆ©ç”¨è€…ã‚’ä½œæˆ
        # Test: is_overdue=True AND has_assessment_due=True
        # Assert: ä¸¡æ–¹ã®æ¡ä»¶ã‚’æº€ãŸã™åˆ©ç”¨è€…ã®ã¿å–å¾—

    async def test_filtered_count_vs_total_count(self, db: AsyncSession):
        """ç·åˆ©ç”¨è€…æ•°ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œä»¶æ•°ãŒæ­£ã—ãåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹"""
        # Setup: 10åã®åˆ©ç”¨è€…ã€ã†ã¡3åãŒæœŸé™åˆ‡ã‚Œ
        # Test: is_overdue=True ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        # Assert:
        #   - current_user_count = 10ï¼ˆå¸¸ã«å›ºå®šï¼‰
        #   - filtered_count = 3ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¾Œï¼‰
```

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆ (`tests/integration/test_dashboard_api.py`)

**æ–°è¦ä½œæˆ**:

```python
class TestDashboardAPI:
    """ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰APIã®çµ±åˆãƒ†ã‚¹ãƒˆ"""

    async def test_filtered_count_in_response(self, client, auth_headers):
        """ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« filtered_count ãŒå«ã¾ã‚Œã‚‹"""
        response = await client.get(
            "/api/v1/dashboard/",
            params={"is_overdue": True},
            headers=auth_headers
        )
        assert response.status_code == 200
        data = response.json()
        assert "current_user_count" in data
        assert "filtered_count" in data  # â† æ–°è¦è¿½åŠ 

    async def test_compound_filter_api(self, client, auth_headers):
        """è¤‡åˆæ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒAPIçµŒç”±ã§æ­£ã—ãå‹•ä½œã™ã‚‹"""
        response = await client.get(
            "/api/v1/dashboard/",
            params={
                "search_term": "ç”°ä¸­",
                "is_overdue": True,
                "has_monitoring_due": True
            },
            headers=auth_headers
        )
        # Assert: ã™ã¹ã¦ã®æ¡ä»¶ã‚’æº€ãŸã™åˆ©ç”¨è€…ã®ã¿è¿”å´
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

#### E2Eãƒ†ã‚¹ãƒˆ (Playwright ã¾ãŸã¯ Cypress)

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:

1. **ç·åˆ©ç”¨è€…æ•°ã®è¡¨ç¤º**
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
   - ã€Œç·åˆ©ç”¨è€…æ•°: Xåã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã—ã¦ã‚‚ã€Œç·åˆ©ç”¨è€…æ•°ã€ã¯å¤‰ã‚ã‚‰ãªã„ã“ã¨

2. **æ¤œç´¢çµæœæ•°ã®è¡¨ç¤º**
   - æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
   - ã€Œæ¤œç´¢çµæœ: Yåã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã¨ä»¶æ•°ãŒæ¸›ã‚‹ã“ã¨

3. **è¤‡åˆæ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**
   - ã€Œè¨ˆç”»æœŸé™åˆ‡ã‚Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ çµæœãŒçµã‚Šè¾¼ã¾ã‚Œã‚‹
   - ã•ã‚‰ã«ã€Œã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã•ã‚‰ã«çµã‚Šè¾¼ã¾ã‚Œã‚‹
   - æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ› â†’ ã•ã‚‰ã«çµã‚Šè¾¼ã¾ã‚Œã‚‹
   - ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒåŒæ™‚ã«é©ç”¨ã•ã‚Œã‚‹ã“ã¨

4. **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è§£é™¤**
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’1ã¤ãšã¤è§£é™¤
   - è§£é™¤ã—ãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã¿ãŒç„¡åŠ¹ã«ãªã‚‹ã“ã¨
   - ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯æœ‰åŠ¹ãªã¾ã¾ã§ã‚ã‚‹ã“ã¨

---

## ğŸ“ å®Ÿè£…ã‚¿ã‚¹ã‚¯

### Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ2æ—¥ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | ãƒ•ã‚¡ã‚¤ãƒ« | å·¥æ•° | å„ªå…ˆåº¦ |
|---|--------|------|----------|------|--------|
| 1.1 | ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ | `DashboardData`ã«`filtered_count`è¿½åŠ  | `app/schemas/dashboard.py` | 30åˆ† | é«˜ |
| 1.2 | APIå®Ÿè£…å¤‰æ›´ | `filtered_count`ã‚’è¨ˆç®—ã—ã¦è¿”å´ | `app/api/v1/endpoints/dashboard.py` | 1æ™‚é–“ | é«˜ |
| 1.3 | ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®Ÿè£… | `has_assessment_due`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¯¾å¿œï¼‰ | `app/api/v1/endpoints/dashboard.py`<br>`app/crud/crud_dashboard.py` | 3æ™‚é–“ | ä¸­ |
| 1.4 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆå¤‰æ›´ | `next_renewal_deadline`ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã« | `app/api/v1/endpoints/dashboard.py` | 30åˆ† | ä½ |
| 1.5 | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ä»¶æ•°åˆ†é›¢ã®ãƒ†ã‚¹ãƒˆ | `tests/crud/test_crud_dashboard_filtering.py` | 3æ™‚é–“ | é«˜ |
| 1.6 | çµ±åˆãƒ†ã‚¹ãƒˆä½œæˆ | APIçµŒç”±ã®E2Eãƒ†ã‚¹ãƒˆ | `tests/integration/test_dashboard_api.py` | 2æ™‚é–“ | é«˜ |

**Phase 1 å°è¨ˆ**: 10æ™‚é–“ï¼ˆç´„1.5æ—¥ï¼‰

---

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ1.5æ—¥ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | ãƒ•ã‚¡ã‚¤ãƒ« | å·¥æ•° | å„ªå…ˆåº¦ |
|---|--------|------|----------|------|--------|
| 2.1 | å‹å®šç¾©æ›´æ–° | `DashboardData`å‹ã«`filtered_count`è¿½åŠ  | `k_front/types/dashboard.ts` | 30åˆ† | é«˜ |
| 2.2 | UIå®Ÿè£…ï¼ˆä»¶æ•°è¡¨ç¤ºï¼‰ | ç·åˆ©ç”¨è€…æ•°ã¨æ¤œç´¢çµæœæ•°ã‚’åˆ†é›¢è¡¨ç¤º | `k_front/components/protected/dashboard/Dashboard.tsx` | 2æ™‚é–“ | é«˜ |
| 2.3 | ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åå¤‰æ›´ | UIæ–‡è¨€ã‚’æ˜ç¢ºåŒ– | `k_front/components/protected/dashboard/FilterButtons.tsx` | 1æ™‚é–“ | ä¸­ |
| 2.4 | ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UI | ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  | `k_front/components/protected/dashboard/FilterButtons.tsx` | 1.5æ™‚é–“ | ä¸­ |
| 2.5 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆå¤‰æ›´ | åˆæœŸå€¤ã‚’`next_renewal_deadline`ã« | `k_front/components/protected/dashboard/Dashboard.tsx` | 30åˆ† | ä½ |
| 2.6 | çŠ¶æ…‹ç®¡ç†ã®æ”¹å–„ | è¤‡åˆæ¡ä»¶ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ | `k_front/components/protected/dashboard/Dashboard.tsx` | 2æ™‚é–“ | é«˜ |
| 2.7 | E2Eãƒ†ã‚¹ãƒˆä½œæˆ | Playwrightã§è¤‡åˆæ¡ä»¶æ¤œç´¢ã‚’ãƒ†ã‚¹ãƒˆ | `k_front/e2e/dashboard.spec.ts` | 3æ™‚é–“ | é«˜ |

**Phase 2 å°è¨ˆ**: 10.5æ™‚é–“ï¼ˆç´„1.5æ—¥ï¼‰

---

### Phase 3: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ0.5æ—¥ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | è©³ç´° | å·¥æ•° | å„ªå…ˆåº¦ |
|---|--------|------|------|--------|
| 3.1 | çµåˆãƒ†ã‚¹ãƒˆ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ + ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºç¢ºèª | 2æ™‚é–“ | é«˜ |
| 3.2 | UIãƒ†ã‚¹ãƒˆ | è¤‡åˆæ¡ä»¶æ¤œç´¢ã®å‹•ä½œç¢ºèªï¼ˆæ‰‹å‹•ï¼‰ | 1æ™‚é–“ | é«˜ |
| 3.3 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ | 500äº‹æ¥­æ‰€ã§ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª | 1æ™‚é–“ | ä¸­ |
| 3.4 | ãƒ‡ãƒ—ãƒ­ã‚¤ | ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â†’ æœ¬ç•ª | 1æ™‚é–“ | é«˜ |

**Phase 3 å°è¨ˆ**: 5æ™‚é–“ï¼ˆç´„0.5æ—¥ï¼‰

---

## ğŸ“Š ç·å·¥æ•°ã‚µãƒãƒªãƒ¼

| Phase | å†…å®¹ | å·¥æ•° | æœŸé–“ |
|-------|------|------|------|
| Phase 1 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… | 10æ™‚é–“ | 1.5æ—¥ |
| Phase 2 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£… | 10.5æ™‚é–“ | 1.5æ—¥ |
| Phase 3 | çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ | 5æ™‚é–“ | 0.5æ—¥ |
| **åˆè¨ˆ** | | **25.5æ™‚é–“** | **ç´„3.5æ—¥** |

---

## âœ… å®Œäº†æ¡ä»¶ï¼ˆDefinition of Doneï¼‰

### æ©Ÿèƒ½è¦ä»¶
- âœ… ç·åˆ©ç”¨è€…æ•°ã¨æ¤œç´¢çµæœæ•°ãŒåˆ†é›¢ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹ï¼ˆè¨ˆç”»æœŸé™åˆ‡ã‚Œã€è¨ˆç”»æœŸé™é–“è¿‘ã€ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ã‚ã‚Šï¼‰
- âœ… ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒå‹•ä½œã™ã‚‹ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¯¾å¿œ: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ â†’ åŸæ¡ˆ â†’ æ‹…å½“è€…ä¼šè­° â†’ æœ¬æ¡ˆ â†’ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼‰
- âœ… è¤‡æ•°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ã¦çµã‚Šè¾¼ã¿ã§ãã‚‹
- âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆãŒæ¬¡å›æ›´æ–°æœŸé™æ˜‡é †ã«ãªã£ã¦ã„ã‚‹

### éæ©Ÿèƒ½è¦ä»¶
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰E2Eãƒ†ã‚¹ãƒˆ: å…¨ã‚·ãƒŠãƒªã‚ªæˆåŠŸ
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: 500msä»¥ä¸‹ï¼ˆ500äº‹æ¥­æ‰€è¦æ¨¡ï¼‰
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Œå‚™

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- âœ… APIä»•æ§˜æ›¸ã®æ›´æ–°
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®æ›´æ–°ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼èª¬æ˜ï¼‰

---

## ğŸš€ å®Ÿè£…é †åºï¼ˆæ¨å¥¨ï¼‰

### Week 1: Day 1-2
1. **Phase 1.1-1.2**: ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ + APIå®Ÿè£…å¤‰æ›´ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰
   - `filtered_count` è¿½åŠ 
   - ãƒ†ã‚¹ãƒˆ: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ

### Week 1: Day 3-4
2. **Phase 1.3-1.4**: ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé–‹å§‹æœŸé™ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¯¾å¿œï¼‰ + ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆ
3. **Phase 1.5-1.6**: ãƒ†ã‚¹ãƒˆå®Œäº†

### Week 2: Day 1-2
4. **Phase 2.1-2.4**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
   - å‹å®šç¾© â†’ UIå®Ÿè£… â†’ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ 

### Week 2: Day 3
5. **Phase 2.5-2.7**: çŠ¶æ…‹ç®¡ç†æ”¹å–„ + E2Eãƒ†ã‚¹ãƒˆ

### Week 2: Day 4
6. **Phase 3**: çµ±åˆãƒ†ã‚¹ãƒˆ + ãƒ‡ãƒ—ãƒ­ã‚¤

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è¦ä»¶å®šç¾©è©³ç´°](./4_kensaku.md)
- [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ](../README.md)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼](../05_security_code_review.md)
- [å®Ÿè£…ã‚¬ã‚¤ãƒ‰](../03_implementation_guide.md)

---

**ä½œæˆæ—¥**: 2026-02-16
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ“‹ TODOï¼ˆæœªç€æ‰‹ï¼‰
**æ‹…å½“**: TBD
**æœŸé™**: TBD
