# 個人開発アプリ向け利用規約の修正案とUIUX設計

## 📝 修正された利用規約

### 利用規約

この利用規約（以下、「本規約」といいます。）は、**安田尚人**（以下、「運営者」といいます。）がこのウェブサイト・アプリケーション上で提供する**ケイカくん**（以下、「本サービス」といいます。）の利用条件を定めるものです。ユーザーの皆さま（以下、「ユーザー」といいます。）には、本規約に従って、本サービスをご利用いただきます。

#### 第1条（適用）
1. 本規約は、ユーザーと運営者との間の本サービスの利用に関わる一切の関係に適用されるものとします。
2. 運営者は本サービスに関し、本規約のほか、ご利用にあたってのルール等、各種の定め（以下、「個別規定」といいます。）をすることがあります。これら個別規定はその名称のいかんに関わらず、本規約の一部を構成するものとします。
3. 本規約の規定が前項の個別規定の規定と矛盾する場合には、個別規定において特段の定めなき限り、個別規定の規定が優先されるものとします。

#### 第2条（利用登録）
1. 本サービスにおいては、登録希望者が本規約に同意の上、運営者の定める方法によって利用登録を申請し、運営者がこれを承認することによって、利用登録が完了するものとします。
2. 運営者は、利用登録の申請者に以下の事由があると判断した場合、利用登録の申請を承認しないことがあり、その理由については一切の開示義務を負わないものとします。
   - 利用登録の申請に際して虚偽の事項を届け出た場合
   - 本規約に違反したことがある者からの申請である場合
   - その他、運営者が利用登録を相当でないと判断した場合

#### 第3条（ユーザーIDおよびパスワードの管理）
1. ユーザーは、自己の責任において、本サービスのユーザーIDおよびパスワードを適切に管理するものとします。
2. ユーザーは、いかなる場合にも、ユーザーIDおよびパスワードを第三者に譲渡または貸与し、もしくは第三者と共用することはできません。運営者は、ユーザーIDとパスワードの組み合わせが登録情報と一致してログインされた場合には、そのユーザーIDを登録しているユーザー自身による利用とみなします。
3. ユーザーID及びパスワードが第三者によって使用されたことによって生じた損害は、運営者に故意又は重大な過失がある場合を除き、運営者は一切の責任を負わないものとします。

#### 第4条（サービスの無償提供）
1. 本サービスは現在無償で提供されています。
2. 運営者は、将来的にサービスの一部または全部を有償化する場合があります。その場合は、事前にユーザーに通知し、同意を得るものとします。

#### 第5条（禁止事項）
ユーザーは、本サービスの利用にあたり、以下の行為をしてはなりません。

1. 法令または公序良俗に違反する行為
2. 犯罪行為に関連する行為
3. 本サービスの内容等、本サービスに含まれる著作権、商標権ほか知的財産権を侵害する行為
4. 運営者、他のユーザー、またはその他第三者のサーバーまたはネットワークの機能を破壊したり、妨害したりする行為
5. 本サービスによって得られた情報を商業的に利用する行為
6. 運営者のサービスの運営を妨害するおそれのある行為
7. 不正アクセスをし、またはこれを試みる行為
8. 他のユーザーに関する個人情報等を収集または蓄積する行為
9. 不正な目的を持って本サービスを利用する行為
10. 本サービスの他のユーザーまたはその他の第三者に不利益、損害、不快感を与える行為
11. 他のユーザーに成りすます行為
12. 運営者が許諾しない本サービス上での宣伝、広告、勧誘、または営業行為
13. 反社会的勢力に対して直接または間接に利益を供与する行為
14. その他、運営者が不適切と判断する行為

#### 第6条（本サービスの提供の停止等）
1. 運営者は、以下のいずれかの事由があると判断した場合、ユーザーに事前に通知することなく本サービスの全部または一部の提供を停止または中断することができるものとします。
   - 本サービスにかかるコンピュータシステムの保守点検または更新を行う場合
   - 地震、落雷、火災、停電または天災などの不可抗力により、本サービスの提供が困難となった場合
   - コンピュータまたは通信回線等が事故により停止した場合
   - その他、運営者が本サービスの提供が困難と判断した場合
2. 運営者は、本サービスの提供の停止または中断により、ユーザーまたは第三者が被ったいかなる不利益または損害についても、一切の責任を負わないものとします。

#### 第7条（利用制限および登録抹消）
1. 運営者は、ユーザーが以下のいずれかに該当する場合には、事前の通知なく、ユーザーに対して、本サービスの全部もしくは一部の利用を制限し、またはユーザーとしての登録を抹消することができるものとします。
   - 本規約のいずれかの条項に違反した場合
   - 登録事項に虚偽の事実があることが判明した場合
   - 運営者からの連絡に対し、一定期間返答がない場合
   - 本サービスについて、最終の利用から一定期間（1年以上）利用がない場合
   - その他、運営者が本サービスの利用を適当でないと判断した場合
2. 運営者は、本条に基づき運営者が行った行為によりユーザーに生じた損害について、一切の責任を負いません。

#### 第8条（退会）
ユーザーは、運営者の定める退会手続により、本サービスから退会できるものとします。

#### 第9条（保証の否認および免責事項）
1. 運営者は、本サービスに事実上または法律上の瑕疵（安全性、信頼性、正確性、完全性、有効性、特定の目的への適合性、セキュリティなどに関する欠陥、エラーやバグ、権利侵害などを含みます。）がないことを明示的にも黙示的にも保証しておりません。
2. 運営者は、本サービスに起因してユーザーに生じたあらゆる損害について、運営者の故意又は重過失による場合を除き、一切の責任を負いません。ただし、本サービスに関する運営者とユーザーとの間の契約（本規約を含みます。）が消費者契約法に定める消費者契約となる場合、この免責規定は適用されません。
3. 前項ただし書に定める場合であっても、運営者は、運営者の過失（重過失を除きます。）による債務不履行または不法行為によりユーザーに生じた損害のうち特別な事情から生じた損害（運営者またはユーザーが損害発生につき予見し、または予見し得た場合を含みます。）について一切の責任を負いません。
4. 運営者は、本サービスに関して、ユーザーと他のユーザーまたは第三者との間において生じた取引、連絡または紛争等について一切責任を負いません。
5. **本サービスは個人により開発・運営されているため、サポート体制や対応時間に制限があることをご了承ください。**

#### 第10条（サービス内容の変更・終了）
1. 運営者は、ユーザーへの事前の告知をもって、本サービスの内容を変更、追加または廃止することがあり、ユーザーはこれを承諾するものとします。
2. **運営者は、本サービスを予告なく終了することがあります。個人運営のため、継続的なサービス提供を保証することはできません。**

#### 第11条（利用規約の変更）
1. 運営者は以下の場合には、ユーザーの個別の同意を要せず、本規約を変更することができるものとします。
   - 本規約の変更がユーザーの一般の利益に適合するとき
   - 本規約の変更が本サービス利用契約の目的に反せず、かつ、変更の必要性、変更後の内容の相当性その他の変更に係る事情に照らして合理的なものであるとき
2. 運営者はユーザーに対し、前項による本規約の変更にあたり、事前に、本規約を変更する旨及び変更後の本規約の内容並びにその効力発生時期を本サービス上で通知します。

#### 第12条（個人情報の取扱い）
運営者は、本サービスの利用によって取得する個人情報については、別途定める「プライバシーポリシー」に従い適切に取り扱うものとします。

#### 第13条（通知または連絡）
1. ユーザーと運営者との間の通知または連絡は、運営者の定める方法によって行うものとします。
2. 運営者は、ユーザーから変更届け出がない限り、現在登録されている連絡先が有効なものとみなして当該連絡先へ通知または連絡を行い、これらは、発信時にユーザーへ到達したものとみなします。
3. **お問い合わせへの回答は、運営者の対応可能な時間内（主に平日夜間・休日）に行います。即時の対応は保証できませんのでご了承ください。**

#### 第14条（権利義務の譲渡の禁止）
ユーザーは、運営者の書面による事前の承諾なく、利用契約上の地位または本規約に基づく権利もしくは義務を第三者に譲渡し、または担保に供することはできません。

#### 第15条（準拠法・裁判管轄）
1. 本規約の解釈にあたっては、日本法を準拠法とします。
2. 本サービスに関して紛争が生じた場合には、**大阪地方裁判所**を第一審の専属的合意管轄裁判所とします。

#### 第16条（運営者情報）
- **運営者氏名**: 安田尚人
- **サービス名**: ケイカくん
- **連絡先**: samonkntd@gmail.com
- **お問い合わせ**: 本サービス内のお問い合わせフォームをご利用ください

---

**制定日**: 2025年11月17日

# プライバシーポリシー

**安田尚人**（以下、「運営者」といいます。）は、本ウェブサイト・アプリケーション上で提供する**ケイカくん**（以下、「本サービス」といいます。）における、ユーザーの個人情報の取扱いについて、以下のとおりプライバシーポリシー（以下、「本ポリシー」といいます。）を定めます。

---

## 第1条（個人情報）

「個人情報」とは、個人情報保護法にいう「個人情報」を指すものとし、生存する個人に関する情報であって、当該情報に含まれる氏名、生年月日、住所、電話番号、連絡先その他の記述等により特定の個人を識別できる情報及び容貌、指紋、声紋にかかるデータ、及び健康保険証の保険者番号などの当該情報単体から特定の個人を識別できる情報（個人識別情報）を指します。

---

## 第2条（個人情報の収集方法）

運営者は、ユーザーが利用登録をする際に以下の個人情報を収集することがあります。

### 【スタッフユーザー（事業所職員）から収集する情報】
- 氏名（姓・名、カナ）
- メールアドレス
- 所属事業所情報
- パスワード（暗号化して保存）
- 2段階認証に関する情報（有効化している場合）

### 【福祉サービス利用者に関する情報】
本サービスは福祉サービス事業所向けの個別支援計画管理システムであり、以下の情報を取り扱います：

- 利用者氏名（姓・名、カナ）
- 生年月日
- 性別
- 住所
- 電話番号
- 緊急連絡先
- 続柄
- 受給者証番号
- 障害者手帳番号
- 障害支援区分
- 個別支援計画の内容
- モニタリング記録
- その他福祉サービス提供に必要な情報

### 【自動的に収集される情報】
- IPアドレス（セキュリティ保護および利用規約同意の記録のため）
- Cookie情報
- アクセスログ
- 利用状況に関する情報
- ブラウザ情報（User-Agent）

**IPアドレスの収集目的**：
- 不正アクセスの検知・防止
- セキュリティインシデントの調査
- 利用規約・プライバシーポリシーへの同意記録（監査証跡）
- 法令に基づく開示請求への対応

**注意**: 運営者は、銀行口座番号、クレジットカード番号、運転免許証番号などの決済情報は収集しません。本サービスは現在無償で提供されています。

---

## 第3条（個人情報を収集・利用する目的）

運営者が個人情報を収集・利用する目的は、以下のとおりです。

1. 本サービスの提供・運営のため
2. 個別支援計画の作成・管理・モニタリングのため
3. ユーザー（スタッフ）からのお問い合わせに回答するため（本人確認を行うことを含む）
4. サービスの新機能、更新情報、重要なお知らせなど必要に応じたご連絡のため
5. 利用規約に違反したユーザーや、不正・不当な目的でサービスを利用しようとするユーザーの特定をし、ご利用をお断りするため
6. ユーザーにご自身の登録情報の閲覧や変更、削除、ご利用状況の閲覧を行っていただくため
7. サービスの改善、新機能の開発のため（統計データとして個人を特定できない形で利用）
8. **利用規約・プライバシーポリシーへの同意記録の保持および監査証跡の確保のため**
9. 不正アクセス・不正利用の検知、防止、および調査のため
10. 上記の利用目的に付随する目的

**福祉サービス利用者情報の利用目的**：
福祉サービス利用者の個人情報は、当該利用者に対する適切な福祉サービスの提供、個別支援計画の作成・実施・評価のためにのみ利用され、それ以外の目的では利用されません。

---

## 第4条（利用目的の変更）

1. 運営者は、利用目的が変更前と関連性を有すると合理的に認められる場合に限り、個人情報の利用目的を変更するものとします。
2. 利用目的の変更を行った場合には、変更後の目的について、本ウェブサイト上に公表し、ユーザーに通知するものとします。

---

## 第5条（個人情報の第三者提供）

1. 運営者は、次に掲げる場合を除いて、あらかじめユーザーの同意を得ることなく、第三者に個人情報を提供することはありません。ただし、個人情報保護法その他の法令で認められる場合を除きます。
   
   (1) 人の生命、身体または財産の保護のために必要がある場合であって、本人の同意を得ることが困難であるとき
   
   (2) 公衆衛生の向上または児童の健全な育成の推進のために特に必要がある場合であって、本人の同意を得ることが困難であるとき
   
   (3) 国の機関もしくは地方公共団体またはその委託を受けた者が法令の定める事務を遂行することに対して協力する必要がある場合であって、本人の同意を得ることにより当該事務の遂行に支障を及ぼすおそれがあるとき

2. 前項の定めにかかわらず、次に掲げる場合には、当該情報の提供先は第三者に該当しないものとします。
   
   (1) 運営者が利用目的の達成に必要な範囲内において個人情報の取扱いの全部または一部を委託する場合（クラウドサービス提供事業者への委託を含む）
   
   (2) 合併その他の事由による事業の承継に伴って個人情報が提供される場合

**現在の第三者提供の状況**：
本サービスは以下のサービスを利用しており、これらの事業者に情報が送信されます：
- Amazon Web Services（AWS）- メールサーバー,画像(PDF保存)
- Google Cloud Run - ホスティング
- neonDB - データベース

---

## 第6条（個人情報の開示）

1. 運営者は、本人から個人情報の開示を求められたときは、本人に対し、遅滞なくこれを開示します。ただし、開示することにより次のいずれかに該当する場合は、その全部または一部を開示しないこともあり、開示しない決定をした場合には、その旨を遅滞なく通知します。
   
   (1) 本人または第三者の生命、身体、財産その他の権利利益を害するおそれがある場合
   
   (2) 運営者の業務の適正な実施に著しい支障を及ぼすおそれがある場合
   
   (3) その他法令に違反することとなる場合

2. 前項の定めにかかわらず、履歴情報および特性情報などの個人情報以外の情報については、原則として開示いたしません。

3. 個人情報の開示請求については、以下の窓口までご連絡ください。手数料は無料です。

---

## 第7条（個人情報の訂正および削除）

1. ユーザーは、運営者の保有する自己の個人情報が誤った情報である場合には、運営者が定める手続きにより、運営者に対して個人情報の訂正、追加または削除（以下、「訂正等」といいます。）を請求することができます。

2. 運営者は、ユーザーから前項の請求を受けてその請求に応じる必要があると判断した場合には、遅滞なく、当該個人情報の訂正等を行うものとします。

3. 運営者は、前項の規定に基づき訂正等を行った場合、または訂正等を行わない旨の決定をしたときは遅滞なく、これをユーザーに通知します。

---

## 第8条（個人情報の利用停止等）

1. 運営者は、本人から、個人情報が、利用目的の範囲を超えて取り扱われているという理由、または不正の手段により取得されたものであるという理由により、その利用の停止または消去（以下、「利用停止等」といいます。）を求められた場合には、遅滞なく必要な調査を行います。

2. 前項の調査結果に基づき、その請求に応じる必要があると判断した場合には、遅滞なく、当該個人情報の利用停止等を行います。

3. 運営者は、前項の規定に基づき利用停止等を行った場合、または利用停止等を行わない旨の決定をしたときは、遅滞なく、これをユーザーに通知します。

4. 前2項にかかわらず、利用停止等に多額の費用を有する場合その他利用停止等を行うことが困難な場合であって、ユーザーの権利利益を保護するために必要なこれに代わるべき措置をとれる場合は、この代替策を講じるものとします。

---

## 第9条（安全管理措置）

運営者は、個人情報の漏えい、滅失または毀損の防止その他の個人情報の安全管理のため、以下の措置を講じています。

### 【組織的安全管理措置】
- 個人情報の取扱いに関する規程の整備
- 個人情報の取扱状況の記録と定期的な確認

### 【人的安全管理措置】
- 個人情報の適切な取扱いに関する教育の実施

### 【物理的安全管理措置】
- サーバーは信頼性の高いクラウドサービス（AWS）を利用
- データセンターでの適切なアクセス制御

### 【技術的安全管理措置】
- SSL/TLS暗号化通信の使用
- パスワードの暗号化保存
- 不正アクセス防止のためのファイアウォール設置
- 定期的なセキュリティアップデート
- アクセスログの記録と監視

---

## 第10条（Cookie等の利用）

1. 本サービスでは、ユーザーの利便性向上およびサービス改善のため、Cookieを使用しています。

2. Cookieによって収集される情報には、以下が含まれます：
   - ログイン状態の維持
   - セッション管理
   - サービス利用状況の分析（Google Analytics使用）

3. ユーザーは、ブラウザの設定によりCookieの受け取りを拒否することができますが、その場合、本サービスの一部機能が利用できなくなる可能性があります。

4. Google Analyticsについて：
   本サービスはGoogle Analyticsを使用してアクセス解析を行っています。Google Analyticsはデータの収集のためにCookieを使用します。このデータは匿名で収集されており、個人を特定するものではありません。
   Google Analyticsの利用規約およびプライバシーポリシーについては、以下をご確認ください：
   - [Google Analytics利用規約](https://marketingplatform.google.com/about/analytics/terms/jp/)
   - [Googleプライバシーポリシー](https://policies.google.com/privacy)

---

## 第11条（プライバシーポリシーの変更）

1. 本ポリシーの内容は、法令その他本ポリシーに別段の定めのある事項を除いて、ユーザーに通知することなく、変更することができるものとします。

2. 変更後のプライバシーポリシーは、本ウェブサイトに掲載したときから効力を生じるものとします。

3. 重要な変更がある場合は、サービス内での通知またはメールにて事前にお知らせします。

---

## 第12条（お問い合わせ窓口）

本ポリシーに関するお問い合わせ、個人情報の開示・訂正・削除・利用停止等のご請求は、下記の窓口までお願いいたします。

**運営者情報**：
- **運営者氏名**: 安田尚人
- **サービス名**: ケイカくん
- **メールアドレス**: samonkntd@gmail.com
- **お問い合わせフォーム**: 本サービス内のお問い合わせフォームをご利用ください

**対応時間**：
個人運営のため、お問い合わせへの対応は主に平日夜間・休日となります。通常1週間以内に返信いたしますが、内容によっては時間を要する場合があります。あらかじめご了承ください。

---

**制定日**: 2025年11月17日  
**最終更新日**: 2025年11月17日

以上
---

## 🎨 UIUXの設計（自然言語での説明）

### 基本コンセプト
「ユーザーに規約を確実に確認してもらいながら、押し付けがましくない体験を提供する」

### 画面構成

#### 1. **利用規約モーダル/ページのレイアウト**

**全体構造**
```
┌─────────────────────────────────────┐
│  📄 利用規約                   [×] │ ← ヘッダー（固定）
├─────────────────────────────────────┤
│                                     │
│  [スクロール可能エリア]              │
│                                     │
│  規約の本文がここに表示される...     │
│  ・                                 │
│  ・                                 │
│  ・                                 │
│  （長い内容）                       │
│                                     │
├─────────────────────────────────────┤
│  📍 最後まで読んで同意してください   │ ← フッター（固定）
│  [同意ボタン]（最初は非活性）        │
└─────────────────────────────────────┘
```

#### 2. **スクロール検知の仕組み**

**段階的な視覚フィードバック**

**初期状態（スクロール0%）**
- 同意ボタンは**グレーアウトで非活性**
- ボタンに「最後までお読みください」というテキスト
- 微かなパルスアニメーションでスクロールを促す
- スクロールバーに**視覚的なインジケーター**（「あと○%」）

**スクロール途中（1-90%）**
- プログレスバーが徐々に進む
- 「あと少しです」といった励ましのメッセージ
- スクロール位置に応じて色が変化（赤→黄→緑）

**最後に到達（95%以上スクロール）**
- 同意ボタンが**アニメーション付きで活性化**
  - フェードイン効果
  - 色が緑系統に変化
  - 軽く拡大してから元のサイズに戻る
- 「✓ 最後までお読みいただきました」というメッセージ表示
- 音声で読み上げる場合は「規約の確認が完了しました」

#### 3. **詳細な実装イメージ**

**スクロールエリア**
- 高さ: 画面の70%程度（モバイルは80%）
- 背景: 白または薄いグレー
- テキストサイズ: 読みやすい14-16px
- 行間: 1.8程度（読みやすさ重視）
- 重要な条項は**太字やハイライト**で強調

**スクロールインジケーター**
```
画面右側に表示:
┌───┐
│███│ ← 現在のスクロール位置（青色）
│░░░│ ← 未読部分（薄いグレー）
│░░░│
└───┘
下に「あと35%」などの数値表示
```

**プログレスバー（画面上部または下部）**
```
[████████████░░░░░░░░] 65%
```

**同意ボタンの状態遷移**

```
状態1: 非活性（スクロール不足）
┌──────────────────────────┐
│  🔒 最後までお読みください  │ ← グレー、クリック不可
│     （あと30%）            │
└──────────────────────────┘

状態2: 活性化（95%以上スクロール）
┌──────────────────────────┐
│  ✓ 利用規約に同意する      │ ← 緑色、クリック可能
│                            │    光るアニメーション
└──────────────────────────┘
```

#### 4. **アクセシビリティ対応**

**キーボード操作**
- Tabキーで同意ボタンにフォーカス移動可能
- スペースキーまたはEnterキーで同意
- Escキーでモーダルを閉じる（同意していない場合は確認ダイアログ）

**スクリーンリーダー対応**
- 「利用規約ダイアログ。本文を最後まで確認してください」
- スクロール完了時: 「規約の確認が完了しました。同意ボタンが有効になりました」
- 同意ボタン: 「利用規約に同意するボタン」

**高齢者・視覚障害者への配慮**
- 文字サイズ変更ボタン（小・中・大）
- ハイコントラストモード切り替え
- 読み上げ機能ボタン（音声合成）

#### 5. **モバイル対応**

**タッチ操作の最適化**
- スワイプでスムーズにスクロール
- 慣性スクロールの実装
- 同意ボタンは最小44x44pxのタップエリア

**画面サイズ対応**
```
モバイル（縦持ち）:
┌─────────────┐
│  利用規約    │ ← ヘッダー
├─────────────┤
│             │
│  スクロール  │ ← 80%の高さ
│  エリア      │
│             │
├─────────────┤
│ [同意ボタン] │ ← 固定フッター
└─────────────┘

タブレット:
デスクトップと同様のレイアウト
```

#### 6. **ユーザーエクスペリエンスの工夫**

**読了を促す仕掛け**
- スクロール位置に応じた「章」の表示
  - 「第1条を読んでいます...」
  - 「あと5項目です」
- 規約の目次を表示（クリックでジャンプ可能）
- 重要な条項の前に⚠️アイコン

**離脱防止**
- 途中で閉じようとすると確認ダイアログ
  ```
  「利用規約を最後まで確認していません。
   本当に閉じますか？」
  [戻る] [閉じる]
  ```

**所要時間の表示**
- 「読了まで約3分」といった目安を表示
- 平均読了時間を計算して表示

#### 7. **スクロール検知の詳細ロジック**

**計算方法**
```
スクロール率 = 
  (現在のスクロール位置 + 表示エリアの高さ) 
  ÷ 全体のコンテンツ高さ 
  × 100

例:
- コンテンツ高さ: 2000px
- 表示エリア: 600px
- スクロール位置: 1300px

スクロール率 = (1300 + 600) ÷ 2000 × 100
            = 95%
```

**活性化の閾値**
- 95%以上で同意ボタンを活性化
- 理由: 最後の100%まで到達は難しいため、余裕を持たせる

#### 8. **段階的なガイダンス**

**初回訪問時**
1. 規約ページが表示される
2. 半透明のオーバーレイで簡単な説明
   ```
   「ケイカくんをご利用いただくには、
    利用規約への同意が必要です。
    
    規約を最後まで読んでいただくと、
    同意ボタンが押せるようになります。」
   
   [理解しました]
   ```

**スクロール開始時**
- 画面右側に小さなヘルプ
  ```
  💡 ヒント
  下にスクロールして
  規約を確認してください
  ```

**中間地点到達時**
- 「半分まで来ました！」というトーストメッセージ
- 応援のメッセージで完読を促す

**完読時**
- 🎉 エフェクト付きで祝福
- 「規約の確認が完了しました」
- 同意ボタンが明るく光る

#### 9. **印刷・保存オプション**

**追加機能**
- 「規約を印刷する」ボタン
- 「PDFでダウンロード」ボタン
- 「後で読む」（メールで送信）

これにより、じっくり確認したいユーザーにも対応

#### 10. **規約変更時の対応**

**既存ユーザーへの通知**
1. ログイン時に「規約が更新されました」モーダル
2. 変更点をハイライト表示
   - 黄色の背景で強調
   - 「変更箇所」というラベル
3. 変更点のみを読めば同意可能（全文読み直し不要）

**変更履歴の表示**
```
利用規約の変更履歴
━━━━━━━━━━━━━━━
2025年11月17日
・第4条を追加（無償提供について）
・第10条を修正（サービス終了の可能性）

2025年8月1日
・初版制定
```

---

## 📱 具体的な実装の流れ

### 実装ステップ

**Step 1: スクロールイベントのリスナー設定**
- スクロールするたびに現在の位置を計算
- スクロール率をリアルタイムで更新

**Step 2: UIの状態管理**
- スクロール率が95%未満: ボタン非活性
- スクロール率が95%以上: ボタン活性化
- 一度活性化したら、上にスクロールしても非活性に戻さない

**Step 3: 視覚フィードバック**
- プログレスバーの更新
- ボタンの状態変更アニメーション
- メッセージの表示/非表示

**Step 4: 同意処理**
- 同意ボタンクリック時
- 同意日時を記録
- ユーザーのプロフィールに保存
- 次回ログイン時は表示しない

---

## 🎯 期待される効果

### ユーザー側
1. **規約を確実に確認**
   - スクロールしないと進めないため、流し読みを防止
   - 重要な条項を見逃さない

2. **透明性の向上**
   - どこまで読んだか視覚的に分かる
   - 残り時間の目安が分かる

3. **ストレスの軽減**
   - 強制的ではなく、自然な流れで確認
   - 進捗が見えるため心理的負担が少ない

### 運営者側
1. **法的リスクの軽減**
   - 「読んでいない」という言い訳を防止
   - 同意の証拠が明確

2. **信頼性の向上**
   - 誠実な対応として評価される
   - 透明性の高い運営

3. **トラブル防止**
   - 規約を理解した上での利用
   - 後からの苦情が減少

---

## ✅ チェックリスト

### 規約の内容
- [x] 「当社」→「運営者」に変更
- [x] 個人開発者向けの表現に修正
- [x] 無償提供について明記
- [x] サービス終了の可能性を記載
- [x] サポート体制の制限を明記
- [x] 管轄裁判所を大阪地裁に設定
- [x] 運営者情報を明記

### UIUXの実装
- [ ] スクロール検知機能
- [ ] プログレスバー表示
- [ ] 同意ボタンの状態管理
- [ ] モバイル対応
- [ ] アクセシビリティ対応

### データベース設計
- [ ] 同意履歴テーブルの作成
- [ ] マイグレーションファイルの作成
- [ ] ORMモデルの実装


この設計により、ユーザーフレンドリーかつ法的要件を満たす利用規約の提示が可能になります！

---

## 📊 同意履歴テーブル設計

### 概要

スタッフユーザーが利用規約・プライバシーポリシーに同意した履歴を記録するテーブルです。
各スタッフと1:1で紐づき、最新の同意状態を管理します。

### 要件

1. **staffsテーブルと1:1の関係**
   - 1人のスタッフに対して1つの同意履歴レコード
   - スタッフ削除時は同意履歴も削除（CASCADE DELETE）

2. **記録する情報**
   - 利用規約への同意日時
   - プライバシーポリシーへの同意日時
   - 同意時のIPアドレス（監査用）
   - 同意時のユーザーエージェント（監査用）
   - 規約のバージョン情報

3. **規約変更時の対応**
   - 規約が更新された場合、再同意が必要
   - バージョン管理により、どの規約に同意したかを記録

---

### データベーススキーマ

#### テーブル: `terms_agreements`

| カラム名 | データ型 | 制約 | 説明 |
|---------|---------|------|------|
| id | UUID | PRIMARY KEY | 同意履歴ID |
| staff_id | UUID | NOT NULL, UNIQUE, FK | スタッフID（1:1関係） |
| terms_of_service_agreed_at | TIMESTAMP WITH TIME ZONE | NULLABLE | 利用規約同意日時 |
| privacy_policy_agreed_at | TIMESTAMP WITH TIME ZONE | NULLABLE | プライバシーポリシー同意日時 |
| terms_version | VARCHAR(50) | NULLABLE | 同意した利用規約のバージョン |
| privacy_version | VARCHAR(50) | NULLABLE | 同意したプライバシーポリシーのバージョン |
| ip_address | VARCHAR(45) | NULLABLE | 同意時のIPアドレス（IPv6対応） |
| user_agent | VARCHAR(500) | NULLABLE | 同意時のユーザーエージェント |
| created_at | TIMESTAMP WITH TIME ZONE | NOT NULL, DEFAULT NOW() | レコード作成日時 |
| updated_at | TIMESTAMP WITH TIME ZONE | NOT NULL, DEFAULT NOW() | レコード更新日時 |

**外部キー制約:**
- `staff_id` → `staffs.id` (ON DELETE CASCADE)

**インデックス:**
- `staff_id`: UNIQUE INDEX（1:1関係を保証）
- `terms_of_service_agreed_at`: INDEX（同意状態の検索用）
- `privacy_policy_agreed_at`: INDEX（同意状態の検索用）

---

### 生SQL（テーブル作成）

```sql
-- 同意履歴テーブルを作成
CREATE TABLE terms_agreements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    staff_id UUID NOT NULL UNIQUE REFERENCES staffs(id) ON DELETE CASCADE,
    terms_of_service_agreed_at TIMESTAMP WITH TIME ZONE,
    privacy_policy_agreed_at TIMESTAMP WITH TIME ZONE,
    terms_version VARCHAR(50),
    privacy_version VARCHAR(50),
    ip_address VARCHAR(45),
    user_agent VARCHAR(500),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- インデックスを作成
CREATE UNIQUE INDEX idx_terms_agreements_staff_id ON terms_agreements(staff_id);
CREATE INDEX idx_terms_agreements_tos_agreed ON terms_agreements(terms_of_service_agreed_at);
CREATE INDEX idx_terms_agreements_privacy_agreed ON terms_agreements(privacy_policy_agreed_at);

-- ダウングレード時
DROP UNIQUE INDEX idx_terms_agreements_staff_id;
DROP INDEX idx_terms_agreements_tos_agreed;
DROP INDEX idx_terms_agreements_privacy_agreed
DROP TABLE terms_agreements;

-- コメント（ドキュメント用）
COMMENT ON TABLE terms_agreements IS '利用規約・プライバシーポリシーの同意履歴';
COMMENT ON COLUMN terms_agreements.staff_id IS 'スタッフID（1:1関係）';
COMMENT ON COLUMN terms_agreements.terms_of_service_agreed_at IS '利用規約同意日時';
COMMENT ON COLUMN terms_agreements.privacy_policy_agreed_at IS 'プライバシーポリシー同意日時';
COMMENT ON COLUMN terms_agreements.terms_version IS '同意した利用規約のバージョン（例: "1.0", "1.1"）';
COMMENT ON COLUMN terms_agreements.privacy_version IS '同意したプライバシーポリシーのバージョン（例: "1.0", "1.1"）';
COMMENT ON COLUMN terms_agreements.ip_address IS '同意時のIPアドレス（監査用）';
COMMENT ON COLUMN terms_agreements.user_agent IS '同意時のユーザーエージェント（監査用）';
```

---

### Alembicマイグレーションファイル

**ファイル名**: `migrations/versions/s4t5u6v7w8x9_add_terms_agreements.py`

```python
"""add terms agreements table

Revision ID: s4t5u6v7w8x9
Revises: r3s4t5u6v7w8
Create Date: 2025-11-18 00:00:00.000000

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 's4t5u6v7w8x9'
down_revision = 'r3s4t5u6v7w8'
branch_labels = None
depends_on = None


def upgrade() -> None:
    """利用規約・プライバシーポリシーの同意履歴テーブルを作成"""

    # terms_agreements テーブルを作成
    op.create_table(
        'terms_agreements',
        sa.Column('id', postgresql.UUID(as_uuid=True), server_default=sa.text('gen_random_uuid()'), nullable=False),
        sa.Column('staff_id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('terms_of_service_agreed_at', sa.DateTime(timezone=True), nullable=True),
        sa.Column('privacy_policy_agreed_at', sa.DateTime(timezone=True), nullable=True),
        sa.Column('terms_version', sa.String(length=50), nullable=True),
        sa.Column('privacy_version', sa.String(length=50), nullable=True),
        sa.Column('ip_address', sa.String(length=45), nullable=True),
        sa.Column('user_agent', sa.String(length=500), nullable=True),
        sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
        sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
        sa.ForeignKeyConstraint(['staff_id'], ['staffs.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )

    # インデックスを作成
    op.create_index('idx_terms_agreements_staff_id', 'terms_agreements', ['staff_id'], unique=True)
    op.create_index('idx_terms_agreements_tos_agreed', 'terms_agreements', ['terms_of_service_agreed_at'], unique=False)
    op.create_index('idx_terms_agreements_privacy_agreed', 'terms_agreements', ['privacy_policy_agreed_at'], unique=False)


def downgrade() -> None:
    """ロールバック"""

    # インデックスを削除
    op.drop_index('idx_terms_agreements_privacy_agreed', table_name='terms_agreements')
    op.drop_index('idx_terms_agreements_tos_agreed', table_name='terms_agreements')
    op.drop_index('idx_terms_agreements_staff_id', table_name='terms_agreements')

    # テーブルを削除
    op.drop_table('terms_agreements')
```

---

### SQLAlchemy ORMモデル

**ファイル**: `app/models/terms_agreement.py` (新規作成)

```python
import uuid
from datetime import datetime
from typing import TYPE_CHECKING, Optional
from sqlalchemy import func, String, DateTime, UUID, ForeignKey
from sqlalchemy.orm import Mapped, mapped_column, relationship

from app.db.base import Base

if TYPE_CHECKING:
    from app.models.staff import Staff


class TermsAgreement(Base):
    """利用規約・プライバシーポリシーの同意履歴"""
    __tablename__ = 'terms_agreements'

    id: Mapped[uuid.UUID] = mapped_column(
        UUID(as_uuid=True),
        primary_key=True,
        server_default=func.gen_random_uuid()
    )
    staff_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey('staffs.id', ondelete="CASCADE"),
        nullable=False,
        unique=True,  # 1:1関係を保証
        index=True
    )
    terms_of_service_agreed_at: Mapped[Optional[datetime]] = mapped_column(
        DateTime(timezone=True),
        nullable=True,
        index=True
    )
    privacy_policy_agreed_at: Mapped[Optional[datetime]] = mapped_column(
        DateTime(timezone=True),
        nullable=True,
        index=True
    )
    terms_version: Mapped[Optional[str]] = mapped_column(
        String(50),
        nullable=True
    )
    privacy_version: Mapped[Optional[str]] = mapped_column(
        String(50),
        nullable=True
    )
    ip_address: Mapped[Optional[str]] = mapped_column(
        String(45),  # IPv6対応（最大45文字）
        nullable=True
    )
    user_agent: Mapped[Optional[str]] = mapped_column(
        String(500),
        nullable=True
    )
    created_at: Mapped[datetime] = mapped_column(
        DateTime(timezone=True),
        server_default=func.now()
    )
    updated_at: Mapped[datetime] = mapped_column(
        DateTime(timezone=True),
        server_default=func.now(),
        onupdate=func.now()
    )

    # リレーション（1:1）
    staff: Mapped["Staff"] = relationship(
        "Staff",
        back_populates="terms_agreement"
    )

    def has_agreed_to_current_terms(self, current_version: str) -> bool:
        """
        現在のバージョンの利用規約に同意しているかチェック

        Args:
            current_version: 現在の利用規約バージョン

        Returns:
            同意している場合True
        """
        return (
            self.terms_of_service_agreed_at is not None
            and self.terms_version == current_version
        )

    def has_agreed_to_current_privacy(self, current_version: str) -> bool:
        """
        現在のバージョンのプライバシーポリシーに同意しているかチェック

        Args:
            current_version: 現在のプライバシーポリシーバージョン

        Returns:
            同意している場合True
        """
        return (
            self.privacy_policy_agreed_at is not None
            and self.privacy_version == current_version
        )

    def has_agreed_to_all_current(
        self,
        terms_version: str,
        privacy_version: str
    ) -> bool:
        """
        現在のバージョンの両方に同意しているかチェック

        Args:
            terms_version: 現在の利用規約バージョン
            privacy_version: 現在のプライバシーポリシーバージョン

        Returns:
            両方に同意している場合True
        """
        return (
            self.has_agreed_to_current_terms(terms_version)
            and self.has_agreed_to_current_privacy(privacy_version)
        )
```

**Staffモデルへの追加** (`app/models/staff.py`):

```python
# Staffクラスに以下のリレーションを追加

from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from app.models.terms_agreement import TermsAgreement

class Staff(Base):
    # ... 既存のコード ...

    # リレーション（1:1）
    terms_agreement: Mapped[Optional["TermsAgreement"]] = relationship(
        "TermsAgreement",
        back_populates="staff",
        uselist=False,  # 1:1関係
        cascade="all, delete-orphan"
    )
```

---

### Pydantic スキーマ

**ファイル**: `app/schemas/terms_agreement.py` (新規作成)

```python
import uuid
from datetime import datetime
from typing import Optional
from pydantic import BaseModel, ConfigDict, IPvAnyAddress


class TermsAgreementBase(BaseModel):
    """同意履歴の基本スキーマ"""
    terms_version: Optional[str] = None
    privacy_version: Optional[str] = None


class TermsAgreementCreate(TermsAgreementBase):
    """同意履歴作成用スキーマ"""
    staff_id: uuid.UUID
    ip_address: Optional[str] = None
    user_agent: Optional[str] = None


class TermsAgreementUpdate(BaseModel):
    """同意履歴更新用スキーマ"""
    terms_of_service_agreed_at: Optional[datetime] = None
    privacy_policy_agreed_at: Optional[datetime] = None
    terms_version: Optional[str] = None
    privacy_version: Optional[str] = None
    ip_address: Optional[str] = None
    user_agent: Optional[str] = None


class TermsAgreementRead(TermsAgreementBase):
    """同意履歴読み取り用スキーマ"""
    id: uuid.UUID
    staff_id: uuid.UUID
    terms_of_service_agreed_at: Optional[datetime] = None
    privacy_policy_agreed_at: Optional[datetime] = None
    created_at: datetime
    updated_at: datetime

    model_config = ConfigDict(from_attributes=True)


class AgreeToTermsRequest(BaseModel):
    """利用規約・プライバシーポリシー同意リクエスト"""
    agree_to_terms: bool
    agree_to_privacy: bool
    terms_version: str = "1.0"
    privacy_version: str = "1.0"


class AgreeToTermsResponse(BaseModel):
    """同意レスポンス"""
    message: str
    agreed_at: datetime
    terms_version: str
    privacy_version: str
```

---

### CRUD操作

**ファイル**: `app/crud/crud_terms_agreement.py` (新規作成)

```python
import uuid
from datetime import datetime, timezone
from typing import Optional
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select

from app.models.terms_agreement import TermsAgreement
from app.schemas.terms_agreement import TermsAgreementCreate, TermsAgreementUpdate


class CRUDTermsAgreement:
    """利用規約同意履歴のCRUD操作"""

    async def get_by_staff_id(
        self,
        db: AsyncSession,
        *,
        staff_id: uuid.UUID
    ) -> Optional[TermsAgreement]:
        """
        スタッフIDで同意履歴を取得（1:1関係）

        Args:
            db: データベースセッション
            staff_id: スタッフID

        Returns:
            同意履歴、または None
        """
        query = select(TermsAgreement).where(TermsAgreement.staff_id == staff_id)
        result = await db.execute(query)
        return result.scalar_one_or_none()

    async def create(
        self,
        db: AsyncSession,
        *,
        obj_in: TermsAgreementCreate
    ) -> TermsAgreement:
        """
        同意履歴を作成

        Args:
            db: データベースセッション
            obj_in: 作成データ

        Returns:
            作成された同意履歴
        """
        db_obj = TermsAgreement(
            staff_id=obj_in.staff_id,
            terms_version=obj_in.terms_version,
            privacy_version=obj_in.privacy_version,
            ip_address=obj_in.ip_address,
            user_agent=obj_in.user_agent
        )
        db.add(db_obj)
        await db.flush()
        await db.refresh(db_obj)
        return db_obj

    async def update(
        self,
        db: AsyncSession,
        *,
        db_obj: TermsAgreement,
        obj_in: TermsAgreementUpdate
    ) -> TermsAgreement:
        """
        同意履歴を更新

        Args:
            db: データベースセッション
            db_obj: 既存のレコード
            obj_in: 更新データ

        Returns:
            更新された同意履歴
        """
        update_data = obj_in.model_dump(exclude_unset=True)

        for field, value in update_data.items():
            setattr(db_obj, field, value)

        await db.flush()
        await db.refresh(db_obj)
        return db_obj

    async def agree_to_terms(
        self,
        db: AsyncSession,
        *,
        staff_id: uuid.UUID,
        terms_version: str,
        privacy_version: str,
        ip_address: Optional[str] = None,
        user_agent: Optional[str] = None
    ) -> TermsAgreement:
        """
        利用規約・プライバシーポリシーに同意

        Args:
            db: データベースセッション
            staff_id: スタッフID
            terms_version: 利用規約バージョン
            privacy_version: プライバシーポリシーバージョン
            ip_address: IPアドレス
            user_agent: ユーザーエージェント

        Returns:
            更新された同意履歴
        """
        now = datetime.now(timezone.utc)

        # 既存の同意履歴を取得
        existing = await self.get_by_staff_id(db, staff_id=staff_id)

        if existing:
            # 既存レコードを更新
            existing.terms_of_service_agreed_at = now
            existing.privacy_policy_agreed_at = now
            existing.terms_version = terms_version
            existing.privacy_version = privacy_version
            existing.ip_address = ip_address
            existing.user_agent = user_agent

            await db.flush()
            await db.refresh(existing)
            return existing
        else:
            # 新規レコードを作成
            db_obj = TermsAgreement(
                staff_id=staff_id,
                terms_of_service_agreed_at=now,
                privacy_policy_agreed_at=now,
                terms_version=terms_version,
                privacy_version=privacy_version,
                ip_address=ip_address,
                user_agent=user_agent
            )
            db.add(db_obj)
            await db.flush()
            await db.refresh(db_obj)
            return db_obj


terms_agreement = CRUDTermsAgreement()
```

**`app/crud/__init__.py`に追加**:

```python
from .crud_terms_agreement import terms_agreement
```

---

### API エンドポイント例

**ファイル**: `app/api/v1/endpoints/terms.py` (新規作成)

```python
from datetime import datetime, timezone
from fastapi import APIRouter, Depends, HTTPException, status, Request
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas
from app.api import deps
from app.models.staff import Staff

router = APIRouter()

# 現在の規約バージョン（定数として管理）
CURRENT_TERMS_VERSION = "1.0"
CURRENT_PRIVACY_VERSION = "1.0"


@router.post("/agree", response_model=schemas.AgreeToTermsResponse)
async def agree_to_terms(
    *,
    db: AsyncSession = Depends(deps.get_db),
    current_user: Staff = Depends(deps.get_current_user),
    request: Request,
    agreement_data: schemas.AgreeToTermsRequest
):
    """
    利用規約・プライバシーポリシーに同意する
    """
    if not agreement_data.agree_to_terms or not agreement_data.agree_to_privacy:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="利用規約とプライバシーポリシーの両方に同意する必要があります"
        )

    # IPアドレスとユーザーエージェントを取得
    ip_address = request.client.host if request.client else None
    user_agent = request.headers.get("user-agent")

    # 同意を記録
    agreement = await crud.terms_agreement.agree_to_terms(
        db,
        staff_id=current_user.id,
        terms_version=agreement_data.terms_version,
        privacy_version=agreement_data.privacy_version,
        ip_address=ip_address,
        user_agent=user_agent
    )

    await db.commit()

    return schemas.AgreeToTermsResponse(
        message="利用規約とプライバシーポリシーへの同意が記録されました",
        agreed_at=agreement.terms_of_service_agreed_at,
        terms_version=agreement.terms_version,
        privacy_version=agreement.privacy_version
    )


@router.get("/status", response_model=schemas.TermsAgreementRead)
async def get_agreement_status(
    *,
    db: AsyncSession = Depends(deps.get_db),
    current_user: Staff = Depends(deps.get_current_user)
):
    """
    現在の同意状態を取得
    """
    agreement = await crud.terms_agreement.get_by_staff_id(
        db,
        staff_id=current_user.id
    )

    if not agreement:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="同意履歴が見つかりません"
        )

    return agreement


@router.get("/required")
async def check_agreement_required(
    *,
    db: AsyncSession = Depends(deps.get_db),
    current_user: Staff = Depends(deps.get_current_user)
):
    """
    同意が必要かチェック
    """
    agreement = await crud.terms_agreement.get_by_staff_id(
        db,
        staff_id=current_user.id
    )

    if not agreement:
        return {
            "required": True,
            "reason": "未同意",
            "current_terms_version": CURRENT_TERMS_VERSION,
            "current_privacy_version": CURRENT_PRIVACY_VERSION
        }

    needs_terms_update = not agreement.has_agreed_to_current_terms(CURRENT_TERMS_VERSION)
    needs_privacy_update = not agreement.has_agreed_to_current_privacy(CURRENT_PRIVACY_VERSION)

    if needs_terms_update or needs_privacy_update:
        return {
            "required": True,
            "reason": "規約が更新されました",
            "needs_terms_update": needs_terms_update,
            "needs_privacy_update": needs_privacy_update,
            "current_terms_version": CURRENT_TERMS_VERSION,
            "current_privacy_version": CURRENT_PRIVACY_VERSION,
            "agreed_terms_version": agreement.terms_version,
            "agreed_privacy_version": agreement.privacy_version
        }

    return {
        "required": False,
        "terms_version": agreement.terms_version,
        "privacy_version": agreement.privacy_version
    }
```

**`app/api/v1/api.py`にルーターを追加**:

```python
from app.api.v1.endpoints import terms

api_router.include_router(terms.router, prefix="/terms", tags=["terms"])
```

---

### 使用例

#### 1. **新規ユーザー登録時**

```python
# 登録後、同意履歴レコードを作成（未同意状態）
agreement = await crud.terms_agreement.create(
    db,
    obj_in=TermsAgreementCreate(staff_id=new_user.id)
)
```

#### 2. **ログイン時のチェック**

```python
# 同意が必要かチェック
agreement = await crud.terms_agreement.get_by_staff_id(db, staff_id=user.id)

if not agreement or not agreement.has_agreed_to_all_current("1.0", "1.0"):
    # フロントエンドに規約表示を指示
    return {"requires_agreement": True}
```

#### 3. **同意処理**

```python
# ユーザーが同意ボタンをクリック
agreement = await crud.terms_agreement.agree_to_terms(
    db,
    staff_id=user.id,
    terms_version="1.0",
    privacy_version="1.0",
    ip_address="192.168.1.1",
    user_agent="Mozilla/5.0..."
)
```

---

### セキュリティ・コンプライアンス考慮事項

1. **監査証跡**
   - 同意日時、IPアドレス、ユーザーエージェントを記録
   - 法的紛争時の証拠として使用可能

2. **GDPR対応**
   - ユーザーは自分の同意履歴を確認可能
   - データ削除リクエストに対応（スタッフ削除時にCASCADE DELETE）

3. **バージョン管理**
   - 規約変更時に古いバージョンに同意したユーザーを特定可能
   - 再同意プロセスの実装が容易

4. **1:1関係の保証**
   - UNIQUEインデックスにより、1人のスタッフに複数レコードが作成されることを防止

---

### テスト項目

#### ユニットテスト
- [ ] 同意履歴の作成
- [ ] 同意履歴の取得（staff_idで検索）
- [ ] 同意履歴の更新
- [ ] バージョンチェックメソッド（`has_agreed_to_current_terms`等）

#### 統合テスト
- [ ] 新規登録時の同意履歴作成
- [ ] ログイン時の同意状態チェック
- [ ] 規約同意APIエンドポイント
- [ ] 規約更新時の再同意フロー

#### データ整合性テスト
- [ ] 1:1関係の保証（同一staff_idで複数レコード作成を試みる）
- [ ] CASCADE DELETE（スタッフ削除時に同意履歴も削除）
- [ ] UNIQUE制約のテスト

---

この設計により、法的要件を満たしつつ、ユーザーの同意状態を適切に管理できます。