# WAFコスト比較: AWS vs GCP

**作成日**: 2026-02-05
**為替レート**: 1 USD = ¥150
**対象**: けいかくんアプリケーション（Cloud Run on GCP）

---

## 📋 目次

1. [エグゼクティブサマリー](#エグゼクティブサマリー)
2. [GCP構成のコスト](#gcp構成のコスト)
3. [AWS構成のコスト](#aws構成のコスト)
4. [詳細比較](#詳細比較)
5. [クロスクラウド構成の考慮事項](#クロスクラウド構成の考慮事項)
6. [結論と推奨事項](#結論と推奨事項)

---

## エグゼクティブサマリー

### コスト比較サマリー（月間100万リクエスト）

| プラットフォーム | 月額費用 | 統合難易度 | 推奨度 |
|----------------|---------|-----------|--------|
| **GCP (Cloud Armor)** | ¥4,706 | ⭐ 容易 | ⭐⭐⭐⭐⭐ |
| **AWS (AWS WAF)** | ¥8,250〜¥12,750 | ⭐⭐⭐⭐ 複雑 | ⭐⭐☆☆☆ |

**結論**: **GCPの方が43%〜63%安価** かつ統合が容易

---

## GCP構成のコスト

### アーキテクチャ

```
インターネット
    ↓
Cloud Load Balancer (外部HTTPS LB)
    ↓
Cloud Armor (WAF)
    ↓
Serverless NEG
    ↓
Cloud Run (k-back) ← 既存環境
```

### 詳細コスト内訳（月間100万リクエスト）

| コスト項目 | 単価 | 数量 | 月額費用 |
|-----------|------|------|---------|
| **Cloud Load Balancer** | | | |
| └ フォワーディングルール | $0.025/時間 | 730時間 | ¥2,737 |
| └ データ処理 | $0.008/GB | 100GB | ¥120 |
| **Cloud Armor** | | | |
| └ ポリシー | $5/ポリシー | 1個 | ¥750 |
| └ ルール（必須6個） | $1/ルール | 6個 | ¥900 |
| └ リクエスト処理 | $0.75/100万req | 100万req | ¥112 |
| **Cloud Logging** | | | |
| └ ログ取り込み（7日保持） | $0.50/GB | 1.2GB | ¥87 |
| **合計** | | | **¥4,706** |

**年間コスト**: ¥56,472

**追加のメリット**:
- ✅ Cloud Runとのネイティブ統合（追加設定不要）
- ✅ 既存のIAM権限を活用
- ✅ Cloud Loggingへの自動統合
- ✅ レイテンシ増加 <1ms

---

## AWS構成のコスト

### シナリオA: AWS WAF + API Gateway（プロキシパターン）

#### アーキテクチャ

```
インターネット
    ↓
AWS Application Load Balancer (ALB)
    ↓
AWS WAF
    ↓
API Gateway (REST API)
    ↓
VPC Link または HTTPS統合
    ↓
Cloud Run (k-back) ← GCP上の既存環境
```

#### 詳細コスト内訳（月間100万リクエスト）

| コスト項目 | 単価 | 数量 | 月額費用 |
|-----------|------|------|---------|
| **AWS Application Load Balancer** | | | |
| └ ALB料金 | $0.0225/時間 | 730時間 | ¥2,464 |
| └ LCU (Load Balancer Capacity Unit) | $0.008/LCU時間 | 730時間 × 1 LCU | ¥876 |
| **AWS WAF** | | | |
| └ Web ACL | $5/Web ACL | 1個 | ¥750 |
| └ ルール | $1/ルール | 6個 | ¥900 |
| └ リクエスト処理 | $0.60/100万req | 100万req | ¥90 |
| **API Gateway** | | | |
| └ REST API | $3.50/100万req | 100万req | ¥525 |
| └ データ転送（アウト） | $0.09/GB | 50GB | ¥675 |
| **クロスクラウドデータ転送** | | | |
| └ AWS → GCP | $0.09/GB | 50GB | ¥675 |
| └ GCP → AWS | $0.12/GB | 50GB | ¥900 |
| **CloudWatch Logs** | | | |
| └ ログ取り込み | $0.50/GB | 2GB | ¥150 |
| └ ログ保存 | $0.03/GB | 2GB | ¥9 |
| **合計** | | | **¥8,014** |

**年間コスト**: ¥96,168

---

### シナリオB: AWS WAF + CloudFront（CDNパターン）

#### アーキテクチャ

```
インターネット
    ↓
CloudFront (CDN)
    ↓
AWS WAF
    ↓
オリジン: Cloud Run (GCP)
```

#### 詳細コスト内訳（月間100万リクエスト）

| コスト項目 | 単価 | 数量 | 月額費用 |
|-----------|------|------|---------|
| **CloudFront** | | | |
| └ リクエスト料金（HTTPS） | $0.0100/10,000req | 100万req | ¥1,500 |
| └ データ転送（アウト・最初の10TB） | $0.085/GB | 50GB | ¥637 |
| └ オリジンフェッチ（GCPへ） | $0.020/GB | 50GB | ¥150 |
| **AWS WAF** | | | |
| └ Web ACL | $5/Web ACL | 1個 | ¥750 |
| └ ルール | $1/ルール | 6個 | ¥900 |
| └ リクエスト処理 | $0.60/100万req | 100万req | ¥90 |
| **クロスクラウドデータ転送** | | | |
| └ GCP → AWS（Egress） | $0.12/GB | 50GB | ¥900 |
| **CloudWatch Logs** | | | |
| └ ログ取り込み | $0.50/GB | 1.5GB | ¥112 |
| **合計** | | | **¥5,039** |

**年間コスト**: ¥60,468

**注**: CloudFrontはキャッシュ効果があるため、実際のオリジンへのリクエスト数は減少する可能性がある（キャッシュヒット率50%想定で25%〜30%コスト削減）

---

### シナリオC: フルAWS移行（参考）

#### アーキテクチャ

```
インターネット
    ↓
AWS Application Load Balancer (ALB)
    ↓
AWS WAF
    ↓
AWS Fargate (ECS) または App Runner
    ↓
Amazon RDS (PostgreSQL)
```

#### 詳細コスト内訳（月間100万リクエスト）

| コスト項目 | 単価 | 数量 | 月額費用 |
|-----------|------|------|---------|
| **AWS Application Load Balancer** | | | |
| └ ALB料金 + LCU | 上記参照 | - | ¥3,340 |
| **AWS WAF** | | | |
| └ Web ACL + ルール + リクエスト | 上記参照 | - | ¥1,740 |
| **AWS Fargate（2vCPU, 4GB）** | | | |
| └ vCPU | $0.04048/vCPU時間 | 1,460時間 | ¥8,870 |
| └ メモリ | $0.004445/GB時間 | 5,840 GB時間 | ¥3,890 |
| **Amazon RDS（db.t4g.small）** | | | |
| └ インスタンス | $0.034/時間 | 730時間 | ¥3,723 |
| └ ストレージ（gp3, 20GB） | $0.115/GB/月 | 20GB | ¥345 |
| **CloudWatch Logs** | | | |
| └ ログ取り込み・保存 | - | - | ¥300 |
| **合計** | | | **¥22,208** |

**年間コスト**: ¥266,496

**注**: フルAWS移行は参考値。既存GCP環境からの移行コスト・移行期間は含まず。

---

## 詳細比較

### コスト比較（トラフィック量別）

#### 月間100万リクエスト

| プラットフォーム | 構成 | 月額費用 | GCP比 |
|----------------|------|---------|-------|
| **GCP** | LB + Cloud Armor | ¥4,706 | - |
| **AWS** | ALB + WAF + API Gateway | ¥8,014 | +70% |
| **AWS** | CloudFront + WAF | ¥5,039 | +7% |
| **AWS** | フル移行 | ¥22,208 | +372% |

#### 月間500万リクエスト

| プラットフォーム | 構成 | 月額費用 | GCP比 |
|----------------|------|---------|-------|
| **GCP** | LB + Cloud Armor | ¥6,248 | - |
| **AWS** | ALB + WAF + API Gateway | ¥13,520 | +116% |
| **AWS** | CloudFront + WAF | ¥8,175 | +31% |
| **AWS** | フル移行 | ¥25,430 | +307% |

**計算内訳（500万リクエスト）**:

**GCP**:
- LB: ¥2,737 + ¥600 = ¥3,337
- Cloud Armor: ¥750 + ¥900 + ¥562 = ¥2,212
- Logging: ¥699
- **合計**: ¥6,248

**AWS (ALB + API Gateway)**:
- ALB: ¥2,464 + ¥876 × 1.5 = ¥3,778
- WAF: ¥750 + ¥900 + ¥450 = ¥2,100
- API Gateway: ¥2,625 + ¥3,375 = ¥6,000
- クロスクラウド転送: ¥787
- Logs: ¥180
- **合計**: ¥13,520

**AWS (CloudFront)**:
- CloudFront: ¥7,500 + ¥3,187 + ¥750 = ¥11,437 (キャッシュなし)
- キャッシュヒット率50%想定: ¥8,175
- WAF: ¥2,100
- クロスクラウド転送: ¥450 (キャッシュ後)
- Logs: ¥112
- **合計**: ¥8,175

#### 月間1,000万リクエスト

| プラットフォーム | 構成 | 月額費用 | GCP比 |
|----------------|------|---------|-------|
| **GCP** | LB + Cloud Armor | ¥8,398 | - |
| **AWS** | ALB + WAF + API Gateway | ¥21,240 | +153% |
| **AWS** | CloudFront + WAF | ¥12,450 | +48% |
| **AWS** | フル移行 | ¥28,652 | +241% |

---

### 機能比較

| 機能 | GCP Cloud Armor | AWS WAF |
|------|----------------|---------|
| **OWASP Top 10対策** | ✅ 事前設定ルール | ✅ マネージドルール |
| **レート制限** | ✅ ネイティブサポート | ✅ ネイティブサポート |
| **地理的制限** | ✅ 国・地域レベル | ✅ 国・地域レベル |
| **IPホワイト/ブラックリスト** | ✅ CIDR形式サポート | ✅ CIDR形式サポート |
| **ボット対策** | ⚠️ reCAPTCHA統合必要 | ✅ AWS WAF Bot Control（追加費用） |
| **カスタムルール** | ✅ CEL式言語 | ✅ 独自式言語 |
| **マネージドルールセット** | ⚠️ 限定的 | ✅ 豊富（Fortinet、F5等） |
| **API統合** | ✅ GCP API | ✅ AWS API |
| **ログ統合** | ✅ Cloud Logging | ✅ CloudWatch Logs |
| **アラート** | ✅ Cloud Monitoring | ✅ CloudWatch Alarms |

---

### 統合難易度比較

#### GCP Cloud Armor（既存環境: Cloud Run on GCP）

**統合難易度**: ⭐ 容易

**必要な作業**:
1. Cloud Load Balancer作成（2時間）
2. Serverless NEG設定（1時間）
3. Cloud Armorポリシー作成（2時間）
4. ルール設定（2時間）
5. テスト・検証（2時間）

**合計工数**: 約8〜10時間

**技術的複雑性**:
- ✅ 同一GCPプロジェクト内で完結
- ✅ IAM権限管理がシンプル
- ✅ ネットワーク設定が最小限
- ✅ レイテンシ増加 <1ms

---

#### AWS WAF（既存環境: Cloud Run on GCP）

**統合難易度**: ⭐⭐⭐⭐ 複雑

**必要な作業（ALB + API Gatewayパターン）**:
1. AWSアカウント設定（2時間）
2. ALB作成（2時間）
3. API Gateway設定（4時間）
4. VPC Linkまたは外部統合設定（4時間）
5. AWS WAF設定（2時間）
6. クロスクラウドネットワーク設定（4時間）
7. DNS設定変更（2時間）
8. HTTPS証明書管理（2時間）
9. IAM権限設定（2時間）
10. CloudWatch Logs統合（2時間）
11. テスト・検証（4時間）

**合計工数**: 約30〜40時間

**技術的複雑性**:
- ⚠️ クロスクラウド構成の複雑性
- ⚠️ レイテンシ増加 10〜50ms（地理的距離による）
- ⚠️ 2つのクラウドプラットフォームの管理
- ⚠️ IAM権限が複雑（AWS + GCP）
- ⚠️ データ転送コストの最適化が必要
- ⚠️ 障害調査が複雑（複数プラットフォーム跨ぎ）

**必要な作業（CloudFrontパターン）**:
1. AWSアカウント設定（2時間）
2. CloudFront Distribution作成（3時間）
3. オリジン設定（Cloud Run URL）（2時間）
4. AWS WAF設定（2時間）
5. キャッシュポリシー設定（3時間）
6. DNS設定変更（2時間）
7. HTTPS証明書管理（2時間）
8. CloudWatch Logs統合（2時間）
9. テスト・検証（4時間）

**合計工数**: 約22〜26時間

**技術的複雑性**:
- ⚠️ キャッシュ戦略の設計が必要
- ⚠️ レイテンシ増加 5〜20ms（エッジロケーション経由）
- ⚠️ 動的コンテンツのキャッシュ無効化設定が複雑
- ✅ API Gatewayパターンより単純

---

### レイテンシ比較

| 構成 | 追加レイテンシ | 理由 |
|------|--------------|------|
| **GCP Cloud Armor** | <1ms | 同一リージョン内（asia-northeast1）で処理 |
| **AWS CloudFront** | 5〜20ms | エッジロケーション経由、オリジンフェッチ |
| **AWS ALB + API Gateway** | 10〜50ms | クロスクラウド通信、複数ホップ |

**実測値の重要性**: 本番適用前に必ず負荷テストを実施

---

### 運用負荷比較

#### GCP Cloud Armor

**月次メンテナンス工数**: 約2時間

**タスク**:
- [ ] ブロックログのレビュー（誤検知確認）
- [ ] ルールの最適化
- [ ] Stripe IPレンジの更新確認
- [ ] コストレビュー

**管理プラットフォーム**: Google Cloudコンソール（1つ）

---

#### AWS WAF

**月次メンテナンス工数**: 約4〜6時間

**タスク**:
- [ ] AWS WAFログのレビュー
- [ ] CloudWatchアラートの確認
- [ ] ルールの最適化
- [ ] クロスクラウドデータ転送コストの分析
- [ ] API Gatewayのスロットリング調整
- [ ] CloudFrontキャッシュヒット率の分析
- [ ] 2つのクラウドプラットフォームのコストレビュー

**管理プラットフォーム**: AWSコンソール + Google Cloudコンソール（2つ）

---

## クロスクラウド構成の考慮事項

### メリット

1. **マルチクラウド戦略**
   - ベンダーロックイン回避
   - リスク分散

2. **高度な機能**
   - AWS WAF Bot Control
   - 豊富なマネージドルールセット

### デメリット

1. **コスト**
   - データ転送費用（Egress料金）
   - 2つのプラットフォームの管理コスト

2. **複雑性**
   - ネットワーク設計の複雑化
   - 障害調査の難易度増加
   - 2つのIAM権限管理

3. **パフォーマンス**
   - レイテンシ増加
   - クロスクラウド通信のオーバーヘッド

4. **運用負荷**
   - 2つのコンソールでの管理
   - 異なるAPI/CLI/SDK
   - スキルセットの拡大が必要

---

## 結論と推奨事項

### コスト面での結論

| トラフィック量 | GCP | AWS (最安) | 差額 | GCPのコスト優位性 |
|--------------|-----|-----------|------|-----------------|
| **100万リクエスト** | ¥4,706 | ¥5,039 (CloudFront) | +¥333 | **GCPが7%安い** |
| **500万リクエスト** | ¥6,248 | ¥8,175 (CloudFront) | +¥1,927 | **GCPが31%安い** |
| **1,000万リクエスト** | ¥8,398 | ¥12,450 (CloudFront) | +¥4,052 | **GCPが48%安い** |

**結論**: **GCPの方が7%〜48%安価**

---

### 総合評価

| 評価項目 | GCP Cloud Armor | AWS WAF (CloudFront) | AWS WAF (ALB+API GW) |
|---------|----------------|---------------------|-------------------|
| **コスト** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐☆☆ | ⭐⭐☆☆☆ |
| **統合難易度** | ⭐⭐⭐⭐⭐ | ⭐⭐☆☆☆ | ⭐☆☆☆☆ |
| **パフォーマンス** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐☆ | ⭐⭐⭐☆☆ |
| **運用負荷** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐☆☆ | ⭐⭐☆☆☆ |
| **機能豊富さ** | ⭐⭐⭐☆☆ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **総合評価** | **⭐⭐⭐⭐⭐** | ⭐⭐⭐☆☆ | ⭐⭐☆☆☆ |

---

### 最終推奨事項

#### 推奨: Google Cloud Armor（GCP）

**理由**:
1. ✅ **コスト**: 7%〜48%安価
2. ✅ **統合**: 既存Cloud Run環境とネイティブ統合
3. ✅ **パフォーマンス**: レイテンシ <1ms
4. ✅ **運用負荷**: 単一プラットフォームで管理
5. ✅ **実装期間**: 1週間（AWS: 3〜5週間）

**年間コスト差額**:
- 100万リクエスト: ¥56,472 (GCP) vs ¥60,468 (AWS) → **¥3,996の節約**
- 500万リクエスト: ¥74,976 (GCP) vs ¥98,100 (AWS) → **¥23,124の節約**
- 1,000万リクエスト: ¥100,776 (GCP) vs ¥149,400 (AWS) → **¥48,624の節約**

---

### AWS WAFを選択すべきケース

以下の条件が**すべて**当てはまる場合のみAWS WAFを検討:

1. ✅ AWS WAF Bot Controlが必須（高度なボット対策が必要）
2. ✅ 予算に余裕がある（年間+¥23,000〜¥49,000）
3. ✅ クロスクラウド運用の体制がある（AWS + GCP両方の専門知識）
4. ✅ マルチクラウド戦略が経営方針
5. ✅ レイテンシ増加（5〜50ms）が許容できる

**現状のけいかくんアプリケーション**: 上記条件に該当せず、**AWS WAFは非推奨**

---

### 次のステップ

#### Phase 0: GCP Cloud Armor検証（推奨）

**期間**: 1週間
**コスト**: ¥3,219/月（最小構成）

**実施内容**:
1. Cloud Load Balancer + Cloud Armor導入
2. 基本ルール設定（SQLi/XSS/RCE）
3. 1週間のログ分析
4. パフォーマンス測定

**判断基準**:
- 誤検知率 <1%
- レイテンシ増加 <10ms
- ブロック効果の確認

#### Phase 1: 本番適用

**期間**: 2週間
**コスト**: ¥4,706/月

**実施内容**:
- すべてのルール適用
- モニタリング・アラート設定
- 運用プロセス確立

---

## 参考資料

### GCP
- [Cloud Armor料金](https://cloud.google.com/armor/pricing)
- [Cloud Load Balancing料金](https://cloud.google.com/load-balancing/pricing)

### AWS
- [AWS WAF料金](https://aws.amazon.com/waf/pricing/)
- [ALB料金](https://aws.amazon.com/elasticloadbalancing/pricing/)
- [CloudFront料金](https://aws.amazon.com/cloudfront/pricing/)
- [API Gateway料金](https://aws.amazon.com/api-gateway/pricing/)

### 既存ドキュメント
- `waf_implementation_proposal.md`
- `waf_cost_estimation_with_lb.md`
- `waf_implementation_guide.md`

---

**ドキュメントバージョン**: 1.0
**最終更新日**: 2026-02-05
**作成者**: Claude Sonnet 4.5
