# 見積もり手法

## 概要

Web受託開発における見積もり手法と、Keikakun APIプロジェクトで実践した工数見積もりのアプローチについて解説します。

---

## 1. 採用した見積もり手法

### 1.1 基本方針: **3点見積もり + ストーリーポイント**

複雑な機能開発では、単一の工数見積もりではなく、**楽観値・標準値・悲観値**の3点で見積もります。

```
期待値 = (楽観値 + 標準値 × 4 + 悲観値) / 6
```

**メリット**:
- リスクを定量化できる
- 不確実性を織り込める
- ステークホルダーへの説明がしやすい

### 1.2 見積もり単位

| 単位 | 用途 | 例 |
|------|------|-----|
| **ストーリーポイント** | 機能の相対的な複雑さ | 「認証機能 = 8pt」「CRUD = 3pt」 |
| **人日** | 実際の工数 | 1pt = 0.5人日（チーム固有の速度） |
| **時間** | タスク分解後の詳細見積もり | 「Stripe Webhook実装 = 6時間」 |

---

## 2. 見積もりプロセス

### 2.1 ステップ1: 要件分解（WBS作成）

機能を**CRUD単位**または**ユーザーストーリー単位**で分解します。

#### 例: 課金機能（Stripe統合）の分解

```
課金機能（全体: 40pt = 20人日）
├── 1. Stripe Customer作成 (5pt = 2.5人日)
│   ├── Customer作成API実装 (3h)
│   ├── Billingモデル設計 (2h)
│   ├── テスト実装 (3h)
│   └── ドキュメント作成 (1h)
│
├── 2. Checkout Session作成 (8pt = 4人日)
│   ├── Checkout Session API実装 (4h)
│   ├── Trial期間計算ロジック (3h)
│   ├── フロントエンド連携 (6h)
│   ├── エラーハンドリング (3h)
│   └── テスト実装 (4h)
│
├── 3. Webhook受信 (13pt = 6.5人日)
│   ├── Webhook署名検証 (4h)
│   ├── イベント処理ロジック (8h)
│   ├── 冪等性実装 (6h)
│   ├── 監査ログ実装 (4h)
│   ├── トランザクション管理 (4h)
│   └── テスト実装（正常系・異常系） (10h)
│
├── 4. Customer Portal連携 (5pt = 2.5人日)
│   ├── Portal Session API実装 (2h)
│   ├── フロントエンド連携 (4h)
│   └── テスト実装 (2h)
│
└── 5. 課金ステータス管理 (9pt = 4.5人日)
    ├── ステータス遷移ロジック (6h)
    ├── Trial期限切れバッチ (5h)
    ├── 読み取り専用モード実装 (4h)
    ├── フロントエンド制御 (6h)
    └── テスト実装 (5h)
```

**見積もりの根拠**:
- **3h**: 単純なCRUD実装
- **6h**: ビジネスロジック含む実装
- **10h**: 複雑なロジック + セキュリティ考慮
- テスト実装 = 実装時間の50-100%

### 2.2 ステップ2: 3点見積もりの適用

| 機能 | 楽観値 | 標準値 | 悲観値 | 期待値 | バッファ |
|------|--------|--------|--------|--------|---------|
| Stripe Webhook実装 | 20h | 32h | 50h | 33h | +1h |
| Google Calendar連携 | 30h | 48h | 80h | 51h | +3h |
| PDF生成機能 | 12h | 20h | 35h | 21h | +1h |
| MFA実装 | 15h | 24h | 40h | 25h | +1h |

**期待値の計算例（Webhook）**:
```
(20 + 32×4 + 50) / 6 = 198 / 6 = 33h
```

### 2.3 ステップ3: リスクバッファの追加

#### リスクカテゴリ別のバッファ率

| リスク要因 | バッファ率 | 具体例 |
|-----------|----------|--------|
| **外部API依存** | +30% | Stripe、Google Calendar、AWS S3 |
| **新技術採用** | +40% | 初めて使うライブラリ（py-vapid） |
| **複雑なビジネスロジック** | +25% | 課金ステータス遷移、カレンダー同期 |
| **セキュリティ要件** | +20% | MFA、暗号化、Rate limiting |
| **本番環境特有の問題** | +15% | Cloud Run、PostgreSQL性能調整 |

#### 例: Google Calendar連携の見積もり

```
基本実装: 48h
+ 外部API依存バッファ: 48h × 30% = 14.4h
+ 認証フロー複雑性: 48h × 20% = 9.6h
────────────────────────────────────
合計: 72h (9人日)
```

---

## 3. 実際の見積もり例（主要機能）

### 3.1 Phase別の工数見積もり

#### Phase 1: MVP（最小機能）- 60人日

| 機能 | ストーリーポイント | 人日 | 実装内容 |
|------|-------------------|------|---------|
| 認証システム（JWT） | 13pt | 6.5日 | サインアップ、ログイン、トークン検証 |
| スタッフ管理 | 8pt | 4日 | CRUD、ロール管理、招待機能 |
| 利用者管理 | 8pt | 4日 | CRUD、プロフィール、検索 |
| 個別支援計画（基本） | 13pt | 6.5日 | CRUD、目標設定 |
| ダッシュボード | 8pt | 4日 | 一覧表示、フィルタ、ソート |
| フロントエンド基盤 | 21pt | 10.5日 | Next.js、認証、共通コンポーネント |
| インフラ構築 | 13pt | 6.5日 | Docker、PostgreSQL、Cloud Run |
| テスト・ドキュメント | 16pt | 8日 | 単体テスト、API仕様書 |
| バッファ（20%） | - | 10日 | 予期せぬ問題対応 |

**合計**: 100pt = **60人日**

#### Phase 2: 課金機能 - 25人日

| 機能 | ストーリーポイント | 人日 | 実装内容 |
|------|-------------------|------|---------|
| Stripe統合 | 40pt | 20日 | Customer、Checkout、Webhook、Portal |
| 課金ステータス制御 | 5pt | 2.5日 | 読み取り専用モード、UI制御 |
| バッファ（10%） | - | 2.5日 | Webhookデバッグ、本番テスト |

**合計**: 45pt = **25人日**

#### Phase 3: カレンダー連携 - 20人日

| 機能 | ストーリーポイント | 人日 | 実装内容 |
|------|-------------------|------|---------|
| Google Calendar API連携 | 21pt | 10.5日 | OAuth2.0、イベント作成、同期 |
| カレンダーアカウント管理 | 8pt | 4日 | 複数アカウント対応、権限管理 |
| 自動イベント作成 | 8pt | 4日 | 支援計画期限からイベント生成 |
| バッファ（15%） | - | 2.8日 | OAuth認証フローのデバッグ |

**合計**: 37pt = **20人日**（切り上げ）

#### Phase 4: 高度な機能 - 30人日

| 機能 | ストーリーポイント | 人日 | 実装内容 |
|------|-------------------|------|---------|
| MFA（多要素認証） | 13pt | 6.5日 | TOTP、QRコード、バックアップコード |
| Web Push通知 | 13pt | 6.5日 | Service Worker、VAPID、通知管理 |
| PDF生成（S3連携） | 13pt | 6.5日 | 署名付きURL、テンプレート、S3アップロード |
| 評価（アセスメント） | 8pt | 4日 | CRUD、スコア計算 |
| バッファ（15%） | - | 3.5日 | ブラウザ互換性、本番環境調整 |

**合計**: 47pt = **27人日** → **30人日**（切り上げ）

### 3.2 全体工数サマリー

```
MVP（Phase 1）:          60人日
課金機能（Phase 2）:      25人日
カレンダー連携（Phase 3）: 20人日
高度な機能（Phase 4）:    30人日
────────────────────────────
合計:                   135人日

1人での開発期間: 約7ヶ月（稼働率70%想定）
2人での開発期間: 約3.5ヶ月
```

---

## 4. 見積もり精度を上げる工夫

### 4.1 過去データの活用

**ベロシティ（開発速度）の計測**:
```
Sprint 1: 25pt / 2週間 = 12.5pt/週
Sprint 2: 30pt / 2週間 = 15pt/週
Sprint 3: 28pt / 2週間 = 14pt/週
────────────────────────────────
平均ベロシティ: 13.8pt/週 ≒ 14pt/週
```

**1ポイントあたりの実績工数**:
```
100pt完了 / 実績50人日 = 1pt = 0.5人日
```

### 4.2 不確実性コーンの理解

プロジェクト初期は見積もり精度が低く、進行するほど精度が上がります。

| フェーズ | 見積もり精度 | バッファ率 |
|---------|------------|-----------|
| 企画段階 | ±60% | +50% |
| 要件定義完了 | ±40% | +30% |
| 基本設計完了 | ±25% | +20% |
| 詳細設計完了 | ±15% | +10% |
| 実装中 | ±10% | +5% |

### 4.3 類似機能との比較

```
【例: メッセージング機能の見積もり】

類似機能の実績:
- スタッフCRUD: 4人日 (8pt)
- 利用者CRUD: 4人日 (8pt)

メッセージング機能の追加要素:
+ リアルタイム性（WebSocket検討） → +50%
+ 既読管理 → +25%
+ 添付ファイル → +30%

見積もり:
4人日 × (1 + 0.5 + 0.25 + 0.3) = 8.2人日 ≒ 8.5人日
```

---

## 5. 見積もりと実績の乖離への対応

### 5.1 実際に発生した乖離例

#### 例1: Stripe Webhook実装

| 項目 | 見積もり | 実績 | 乖離率 | 原因 |
|------|---------|------|--------|------|
| Webhook実装 | 33h | 42h | +27% | 冪等性実装の複雑化、MissingGreenletエラーのデバッグ |

**対応**:
- トランザクション管理をService層に移動
- `webhook_events`テーブルで冪等性保証
- 監査ログを全イベントで記録

**教訓**:
- 外部APIとのやり取りは+30%バッファが妥当
- ORM（SQLAlchemy）の非同期処理は想定以上の学習コストがある

#### 例2: Google Calendar連携

| 項目 | 見積もり | 実績 | 乖離率 | 原因 |
|------|---------|------|--------|------|
| Calendar API連携 | 48h | 65h | +35% | OAuth2.0フローのリフレッシュトークン処理、Fernet暗号化の追加 |

**対応**:
- サービスアカウントキーの暗号化（Fernet）
- リフレッシュトークンの自動更新ロジック
- エラーハンドリングの強化

**教訓**:
- OAuth2.0フローは+40%バッファが必要
- セキュリティ要件（暗号化）は後から追加されがち

#### 例3: MFA実装（見積もりより早く完了）

| 項目 | 見積もり | 実績 | 乖離率 | 原因 |
|------|---------|------|--------|------|
| MFA実装 | 25h | 18h | -28% | PyOTPライブラリが想定以上に使いやすかった |

**教訓**:
- ライブラリの品質が高い場合、楽観値に近づく
- 事前調査（PoC）で精度向上可能

### 5.2 乖離が発生した際の対応フロー

```
乖離検出（週次レビュー）
    ↓
原因分析（技術的 or 要件変更）
    ↓
┌─────────────┬─────────────┐
│ 技術的課題   │ 要件変更    │
└─────────────┴─────────────┘
    ↓               ↓
スコープ調整   追加見積もり
または          +
技術的解決      予算調整
    ↓               ↓
ステークホルダーへ報告
```

---

## 6. 見積もりツール・手法

### 6.1 使用したツール

| ツール | 用途 | 例 |
|--------|------|-----|
| **GitHub Issues** | タスク管理、ストーリーポイント管理 | Issueにラベル`SP: 8`を追加 |
| **GitHub Projects** | カンバンボード、スプリント管理 | To Do → In Progress → Done |
| **Excel/Google Sheets** | 詳細見積もり、工数集計 | WBS、ガントチャート |
| **Miro/FigJam** | 要件整理、ユーザーストーリーマッピング | 機能の優先順位付け |

### 6.2 プランニングポーカー

チーム開発では**プランニングポーカー**で見積もりの合意形成:

```
機能: 「Stripe Webhook実装」

メンバーA: 13pt（複雑だが経験あり）
メンバーB: 20pt（冪等性実装が不安）
メンバーC: 13pt（ライブラリで簡単になるはず）

→ 議論の結果: 13pt（ただしバッファ+20%）
```

### 6.3 フィボナッチ数列の採用

ストーリーポイントはフィボナッチ数列（1, 2, 3, 5, 8, 13, 21...）を使用:

```
1pt  = 極小（型定義、設定変更）
2pt  = 小（シンプルなCRUD）
3pt  = 小-中（バリデーション付きCRUD）
5pt  = 中（ビジネスロジック含むCRUD）
8pt  = 中-大（外部API連携、複雑なロジック）
13pt = 大（認証システム、課金システム）
21pt = 超大（大規模リファクタリング、新技術調査）
```

**なぜフィボナッチか**:
- 大きな数字ほど不確実性が高い
- 8ptと13ptの差は、1ptと2ptの差より大きい
- 見積もりの精度を自然に表現できる

---

## 7. 見積もりのアンチパターン

### 7.1 避けるべきパターン

| アンチパターン | 問題点 | 改善策 |
|--------------|--------|--------|
| **バッファなし見積もり** | 100%完璧に進む前提 | 最低でも+15%のバッファ |
| **楽観値のみで見積もり** | 遅延が常態化 | 3点見積もりで期待値を算出 |
| **実績を記録しない** | ベロシティが計測できない | Sprint終了時に必ず記録 |
| **細かすぎる分解** | 見積もりに時間がかかりすぎる | 8時間以下のタスクは分解不要 |
| **乖離を放置** | 原因が特定できない | 週次で実績を確認し、原因分析 |

### 7.2 よくある見積もりミス

```
❌ 「Stripe統合は簡単そうだから2日でできる」
   → 実際: Webhook署名検証、冪等性、エラーハンドリングで8日

✅ 「Stripe統合は外部API依存なので、基本5日+バッファ3日=8日」
   → 実際: 8日（見積もり通り）

❌ 「テストは実装の10%でいい」
   → 実際: セキュリティテストで実装と同等の時間が必要

✅ 「テストは実装の50-100%」
   → 実際: 重要機能は100%、CRUD系は50%
```

---

## 8. ステークホルダーへの見積もり提示

### 8.1 提示フォーマット

```
【見積もり書】Keikakun API 課金機能実装

■ 機能概要
Stripe統合による課金機能の実装

■ 見積もり工数
標準工数:    20人日
リスクバッファ: 5人日 (+25%)
合計:       25人日

■ 工数内訳
1. Stripe Customer作成    2.5人日
2. Checkout Session作成   4人日
3. Webhook受信           6.5人日
4. Customer Portal連携    2.5人日
5. 課金ステータス管理     4.5人日

■ 前提条件
- Stripeアカウントは事前に作成済み
- 本番環境のWebhook URLは提供される
- テスト用クレジットカード情報は提供される

■ リスク要因
- Webhook署名検証の実装難易度（中）
- 冪等性実装の複雑性（中）
- 本番環境でのWebhookテスト（中）

■ スケジュール
開始: 2026-02-01
完了: 2026-02-28（1ヶ月、1名フルタイム想定）

■ マイルストーン
Week 1: Stripe Customer + Checkout Session
Week 2: Webhook実装（署名検証、冪等性）
Week 3: ステータス管理 + Portal連携
Week 4: テスト、本番環境調整、ドキュメント
```

### 8.2 不確実性の伝え方

```
「Webhook実装は、Stripeの公式ドキュメント通りに進めば20時間ですが、
冪等性実装やトランザクション管理を含めると、
最大で35時間かかる可能性があります。
そのため、期待値として33時間（約4人日）で見積もっています。」
```

---

## 9. 面接で強調すべきポイント

### 9.1 見積もり手法の説明

**質問**: 「見積もりはどうしていましたか？」

**回答例**:
> 「3点見積もりとストーリーポイントを組み合わせた手法を採用していました。具体的には、機能を楽観値・標準値・悲観値の3つで見積もり、期待値を算出します。例えば、Stripe Webhook実装では、楽観値20時間、標準値32時間、悲観値50時間として、期待値33時間と算出しました。また、外部API依存やセキュリティ要件に応じて15-40%のリスクバッファを追加しています。」

**深掘り対応**:
- 「フィボナッチ数列を使う理由は？」→ 大きな機能ほど不確実性が高いため
- 「見積もりと実績の乖離は？」→ Webhook実装で+27%、Calendar連携で+35%、原因分析と改善策を説明
- 「どうやって精度を上げたか？」→ ベロシティ計測、類似機能との比較、過去データの蓄積

### 9.2 技術的深さのアピール

**具体例を使った説明**:
> 「例えば、Google Calendar連携は当初48時間と見積もりましたが、OAuth2.0のリフレッシュトークン処理やFernet暗号化の追加で65時間かかりました。この経験から、外部APIを使う場合は+40%のバッファが妥当だと学びました。現在では、類似機能の見積もり時にこの実績データを参照しています。」

### 9.3 プロジェクト管理能力

**アピールポイント**:
1. **データドリブン**: ベロシティを計測し、1pt = 0.5人日という実績データを活用
2. **リスク管理**: 外部API依存、新技術採用などのリスク要因を定量化
3. **透明性**: ステークホルダーに不確実性を明示的に伝える
4. **継続的改善**: 見積もりと実績の乖離を分析し、次回の精度向上に活かす

---

## 10. 今後の改善計画

### 10.1 見積もり精度の向上

- [ ] **実績データの蓄積**: 全タスクの見積もりと実績を記録
- [ ] **乖離要因の分類**: 技術的 / 要件変更 / 外部要因でカテゴリ分け
- [ ] **機能別の補正係数**: 「外部API = ×1.3」「新技術 = ×1.4」などを定義

### 10.2 ツール導入

- [ ] **Jira / Linear**: ストーリーポイント管理の自動化
- [ ] **GitHub Actions**: 見積もりと実績の自動集計
- [ ] **Notion / Confluence**: 見積もりナレッジベースの構築

### 10.3 チーム見積もりの実践

- [ ] **プランニングポーカー**: チームでの合意形成
- [ ] **Retrospective**: Sprint終了時に見積もり精度を振り返り
- [ ] **Estimation Workshop**: 定期的な見積もり勉強会

---

## 11. 参考資料

- [Software Estimation: Demystifying the Black Art (Steve McConnell)](https://www.amazon.co.jp/dp/0735605351)
- [Agile Estimating and Planning (Mike Cohn)](https://www.mountaingoatsoftware.com/books/agile-estimating-and-planning)
- [The Cone of Uncertainty (PMI)](https://www.pmi.org/learning/library/cone-uncertainty-7849)
- [Three-Point Estimation (PMI)](https://www.pmi.org/learning/library/three-point-estimating-technique-6110)

---

**作成日**: 2026-01-29
**対象面接**: Web受託系アプリ開発 2次面接
**カテゴリ**: プロジェクト管理 / 見積もり / 工数管理
